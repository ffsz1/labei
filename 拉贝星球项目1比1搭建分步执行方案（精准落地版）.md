# æ‹‰è´æ˜Ÿçƒé¡¹ç›® 1:1 æ­å»ºåˆ†æ­¥æ‰§è¡Œæ–¹æ¡ˆï¼ˆç²¾å‡†è½åœ°ç‰ˆï¼‰

> **æ ¸å¿ƒåŸåˆ™ï¼š** é›¶åå·®é€‚é…ã€é€æ­¥éªŒè¯ã€100%åŒ¹é…æºç   
> **æ‰§è¡Œç›®æ ‡ï¼š** ç¡®ä¿æ¯ä¸€æ­¥éƒ½å¯éªŒè¯ã€å¯å›é€€ã€å¯å¤ç°  
> **ç”Ÿæˆæ—¶é—´ï¼š** 2025-11-10

---

## ğŸ“‹ æ‰§è¡Œæ€»è§ˆ

```
é˜¶æ®µ1: ç¯å¢ƒå‡†å¤‡ï¼ˆä¾èµ–ç‰ˆæœ¬ç²¾å‡†åŒ¹é…ï¼‰
  â”œâ”€ 1.1 ä¾èµ–æ¸…å•æ ¸å¯¹
  â”œâ”€ 1.2 ç›®å½•ç»“æ„å¤åˆ»
  â””â”€ 1.3 é…ç½®æ–‡ä»¶é¢„å¤„ç†

é˜¶æ®µ2: æºç éƒ¨ç½²ï¼ˆåˆ†æ¨¡å—é€ä¸ªéªŒè¯ï¼‰
  â”œâ”€ 2.1 æ•°æ®åº“éƒ¨ç½²ä¸éªŒè¯
  â”œâ”€ 2.2 åç«¯æœåŠ¡éƒ¨ç½²ä¸éªŒè¯
  â”œâ”€ 2.3 IMæœåŠ¡å™¨éƒ¨ç½²ä¸éªŒè¯
  â””â”€ 2.4 å‰ç«¯H5éƒ¨ç½²ä¸éªŒè¯

é˜¶æ®µ3: åŒ¹é…åº¦éªŒè¯ï¼ˆå…¨æµç¨‹æ ¡éªŒï¼‰
  â”œâ”€ 3.1 ç›®å½•ç»“æ„1:1æ ¡éªŒ
  â”œâ”€ 3.2 åŠŸèƒ½å®Œæ•´æ€§æµ‹è¯•
  â””â”€ 3.3 ä¸€é”®è„šæœ¬å¤ç”¨æ€§æµ‹è¯•
```

---

## ğŸ¯ é˜¶æ®µ1: ç¯å¢ƒå‡†å¤‡ï¼ˆä¾èµ–ç‰ˆæœ¬ç²¾å‡†åŒ¹é…ï¼‰

### 1.1 ä¾èµ–æ¸…å•æ ¸å¯¹ï¼ˆæ‹’ç»é«˜ç‰ˆæœ¬å…¼å®¹å°è¯•ï¼‰

#### âœ… æ ¸å¿ƒä¾èµ–ç‰ˆæœ¬æ¸…å•ï¼ˆä»æºç æå–ï¼‰

| ç»„ä»¶ | ç²¾ç¡®ç‰ˆæœ¬ | æ¥æºæ–‡ä»¶ | éªŒè¯å‘½ä»¤ | çŠ¶æ€ |
|------|---------|---------|---------|------|
| **JDK** | 1.8 | adminbak/pom.xml:352 | `java -version` | â¬œ å¾…éªŒè¯ |
| **Maven** | 3.5+ | æ„å»ºå·¥å…· | `mvn -version` | â¬œ å¾…éªŒè¯ |
| **Node.js** | 8.x - 12.x | imsvr/package.json | `node -v` | â¬œ å¾…éªŒè¯ |
| **npm** | 6.x+ | Node.jsåŒ…ç®¡ç†å™¨ | `npm -v` | â¬œ å¾…éªŒè¯ |
| **MySQL** | 5.7 | æ•°æ®åº“ | `mysql --version` | â¬œ å¾…éªŒè¯ |
| **Redis** | 3.2+ | ç¼“å­˜ | `redis-server --version` | â¬œ å¾…éªŒè¯ |
| **MongoDB** | 4.0+ | IMæ¶ˆæ¯å­˜å‚¨ | `mongod --version` | â¬œ å¾…éªŒè¯ |
| **ActiveMQ** | 5.15+ | æ¶ˆæ¯é˜Ÿåˆ— | è®¿é—® :8161/admin | â¬œ å¾…éªŒè¯ |
| **PM2** | æœ€æ–°ç‰ˆ | Node.jsè¿›ç¨‹ç®¡ç† | `pm2 -v` | â¬œ å¾…éªŒè¯ |

#### âœ… Javaåç«¯ä¾èµ–ç‰ˆæœ¬ï¼ˆç²¾ç¡®åŒ¹é…ï¼‰

**adminbak æ¨¡å—ï¼š**
```xml
<!-- ä» adminbak/pom.xml æå– -->
<springframework.version>4.1.0.RELEASE</springframework.version>
<spring.security.version>3.2.5.RELEASE</spring.security.version>
<aspectj.version>1.6.10</aspectj.version>
<guava.version>18.0</guava.version>
<jackson.version>2.3.3</jackson.version>
<jedis.version>2.6.0</jedis.version>
<java.version>1.8</java.version>
```

**apiservice æ¨¡å—ï¼š**
```xml
<!-- ä» apiservice/pom.xml æå– -->
<parent>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-parent</artifactId>
    <version>2.0.1.RELEASE</version>
</parent>
<alibaba.druid>1.1.9</alibaba.druid>
```

#### âœ… Node.jsä¾èµ–ç‰ˆæœ¬ï¼ˆç²¾ç¡®åŒ¹é…ï¼‰

**imsvr æ¨¡å—ï¼š**
```json
// ä» imsvr/package.json æå–
{
  "koa": "2.3.0",
  "socket.io": "^2.3.0",
  "express": "^4.18.2",
  "mysql": "^2.12.0",
  "mongoose": "~4.0.1",
  "redis": "~0.12.1",
  "koa.io": "^2.3.0"
}
```

#### ğŸ“ æ‰§è¡Œæ­¥éª¤1.1ï¼šä¾èµ–ç‰ˆæœ¬éªŒè¯è„šæœ¬

**Windows éªŒè¯è„šæœ¬ (check-env.bat):**
```batch
@echo off
echo ========================================
echo æ‹‰è´æ˜Ÿçƒé¡¹ç›®ç¯å¢ƒä¾èµ–æ£€æŸ¥
echo ========================================
echo.

echo [1/9] æ£€æŸ¥ JDK ç‰ˆæœ¬...
java -version 2>&1 | findstr "1.8"
if errorlevel 1 (
    echo âŒ JDK ç‰ˆæœ¬ä¸åŒ¹é…ï¼éœ€è¦ JDK 1.8
    set ERROR=1
) else (
    echo âœ… JDK 1.8 å·²å®‰è£…
)
echo.

echo [2/9] æ£€æŸ¥ Maven ç‰ˆæœ¬...
mvn -version 2>&1 | findstr "Apache Maven"
if errorlevel 1 (
    echo âŒ Maven æœªå®‰è£…ï¼
    set ERROR=1
) else (
    echo âœ… Maven å·²å®‰è£…
)
echo.

echo [3/9] æ£€æŸ¥ Node.js ç‰ˆæœ¬...
node -v 2>&1 | findstr "v1"
if errorlevel 1 (
    echo âŒ Node.js ç‰ˆæœ¬ä¸åŒ¹é…ï¼éœ€è¦ 8.x - 12.x
    set ERROR=1
) else (
    echo âœ… Node.js å·²å®‰è£…
)
echo.

echo [4/9] æ£€æŸ¥ npm ç‰ˆæœ¬...
npm -v
if errorlevel 1 (
    echo âŒ npm æœªå®‰è£…ï¼
    set ERROR=1
) else (
    echo âœ… npm å·²å®‰è£…
)
echo.

echo [5/9] æ£€æŸ¥ MySQL æœåŠ¡...
sc query MySQL | findstr "RUNNING"
if errorlevel 1 (
    echo âŒ MySQL æœåŠ¡æœªè¿è¡Œï¼
    set ERROR=1
) else (
    echo âœ… MySQL æœåŠ¡è¿è¡Œä¸­
)
echo.

echo [6/9] æ£€æŸ¥ Redis æœåŠ¡...
tasklist | findstr "redis-server.exe"
if errorlevel 1 (
    echo âŒ Redis æœåŠ¡æœªè¿è¡Œï¼
    set ERROR=1
) else (
    echo âœ… Redis æœåŠ¡è¿è¡Œä¸­
)
echo.

echo [7/9] æ£€æŸ¥ MongoDB æœåŠ¡...
sc query MongoDB | findstr "RUNNING"
if errorlevel 1 (
    echo âŒ MongoDB æœåŠ¡æœªè¿è¡Œï¼
    set ERROR=1
) else (
    echo âœ… MongoDB æœåŠ¡è¿è¡Œä¸­
)
echo.

echo [8/9] æ£€æŸ¥ ActiveMQ...
tasklist | findstr "java.exe" | findstr "activemq"
if errorlevel 1 (
    echo âš ï¸  ActiveMQ å¯èƒ½æœªè¿è¡Œï¼ˆå¯é€‰ï¼‰
) else (
    echo âœ… ActiveMQ æœåŠ¡è¿è¡Œä¸­
)
echo.

echo [9/9] æ£€æŸ¥ PM2...
pm2 -v
if errorlevel 1 (
    echo âŒ PM2 æœªå®‰è£…ï¼
    set ERROR=1
) else (
    echo âœ… PM2 å·²å®‰è£…
)
echo.

echo ========================================
if defined ERROR (
    echo âŒ ç¯å¢ƒæ£€æŸ¥å¤±è´¥ï¼è¯·å®‰è£…ç¼ºå¤±çš„ç»„ä»¶
    exit /b 1
) else (
    echo âœ… æ‰€æœ‰ä¾èµ–æ£€æŸ¥é€šè¿‡ï¼
    exit /b 0
)
```

**Linux éªŒè¯è„šæœ¬ (check-env.sh):**
```bash
#!/bin/bash

echo "========================================"
echo "æ‹‰è´æ˜Ÿçƒé¡¹ç›®ç¯å¢ƒä¾èµ–æ£€æŸ¥"
echo "========================================"
echo ""

ERROR=0

echo "[1/9] æ£€æŸ¥ JDK ç‰ˆæœ¬..."
if java -version 2>&1 | grep -q "1.8"; then
    echo "âœ… JDK 1.8 å·²å®‰è£…"
else
    echo "âŒ JDK ç‰ˆæœ¬ä¸åŒ¹é…ï¼éœ€è¦ JDK 1.8"
    ERROR=1
fi
echo ""

echo "[2/9] æ£€æŸ¥ Maven ç‰ˆæœ¬..."
if mvn -version 2>&1 | grep -q "Apache Maven"; then
    echo "âœ… Maven å·²å®‰è£…"
else
    echo "âŒ Maven æœªå®‰è£…ï¼"
    ERROR=1
fi
echo ""

echo "[3/9] æ£€æŸ¥ Node.js ç‰ˆæœ¬..."
NODE_VERSION=$(node -v 2>&1)
if [[ $NODE_VERSION =~ v1[0-2] ]]; then
    echo "âœ… Node.js $NODE_VERSION å·²å®‰è£…"
else
    echo "âŒ Node.js ç‰ˆæœ¬ä¸åŒ¹é…ï¼éœ€è¦ 8.x - 12.xï¼Œå½“å‰: $NODE_VERSION"
    ERROR=1
fi
echo ""

echo "[4/9] æ£€æŸ¥ npm ç‰ˆæœ¬..."
if npm -v &> /dev/null; then
    echo "âœ… npm $(npm -v) å·²å®‰è£…"
else
    echo "âŒ npm æœªå®‰è£…ï¼"
    ERROR=1
fi
echo ""

echo "[5/9] æ£€æŸ¥ MySQL æœåŠ¡..."
if systemctl is-active --quiet mysqld || systemctl is-active --quiet mysql; then
    echo "âœ… MySQL æœåŠ¡è¿è¡Œä¸­"
else
    echo "âŒ MySQL æœåŠ¡æœªè¿è¡Œï¼"
    ERROR=1
fi
echo ""

echo "[6/9] æ£€æŸ¥ Redis æœåŠ¡..."
if systemctl is-active --quiet redis; then
    echo "âœ… Redis æœåŠ¡è¿è¡Œä¸­"
else
    echo "âŒ Redis æœåŠ¡æœªè¿è¡Œï¼"
    ERROR=1
fi
echo ""

echo "[7/9] æ£€æŸ¥ MongoDB æœåŠ¡..."
if systemctl is-active --quiet mongod; then
    echo "âœ… MongoDB æœåŠ¡è¿è¡Œä¸­"
else
    echo "âŒ MongoDB æœåŠ¡æœªè¿è¡Œï¼"
    ERROR=1
fi
echo ""

echo "[8/9] æ£€æŸ¥ ActiveMQ..."
if pgrep -f activemq > /dev/null; then
    echo "âœ… ActiveMQ æœåŠ¡è¿è¡Œä¸­"
else
    echo "âš ï¸  ActiveMQ å¯èƒ½æœªè¿è¡Œï¼ˆå¯é€‰ï¼‰"
fi
echo ""

echo "[9/9] æ£€æŸ¥ PM2..."
if pm2 -v &> /dev/null; then
    echo "âœ… PM2 $(pm2 -v) å·²å®‰è£…"
else
    echo "âŒ PM2 æœªå®‰è£…ï¼"
    ERROR=1
fi
echo ""

echo "========================================"
if [ $ERROR -eq 0 ]; then
    echo "âœ… æ‰€æœ‰ä¾èµ–æ£€æŸ¥é€šè¿‡ï¼"
    exit 0
else
    echo "âŒ ç¯å¢ƒæ£€æŸ¥å¤±è´¥ï¼è¯·å®‰è£…ç¼ºå¤±çš„ç»„ä»¶"
    exit 1
fi
```

---

### 1.2 ç›®å½•ç»“æ„å¤åˆ»ï¼ˆå®Œå…¨ä¸€è‡´çš„æ–‡ä»¶å¤¹å±‚çº§ï¼‰

#### âœ… æºç ç›®å½•ç»“æ„ï¼ˆä»å®é™…é¡¹ç›®æå–ï¼‰

```
C:/Users/ä¼˜é…ªæ—¶å…‰/Desktop/labei/
â”œâ”€â”€ adminbak/                          # æ—§ç‰ˆSpring MVCåå°
â”‚   â”œâ”€â”€ xchat-admin-service/
â”‚   â”œâ”€â”€ xchat-admin-web/
â”‚   â”œâ”€â”€ xchat-common/
â”‚   â”œâ”€â”€ xchat-oauth2-service/
â”‚   â”œâ”€â”€ xchat-oauth2-web/
â”‚   â”œâ”€â”€ xchat-service/
â”‚   â”œâ”€â”€ xchat-web/
â”‚   â””â”€â”€ pom.xml
â”œâ”€â”€ apiservice/                        # æ–°ç‰ˆSpring BootæœåŠ¡
â”‚   â”œâ”€â”€ xchat-base/
â”‚   â”œâ”€â”€ xchat-dao/
â”‚   â”œâ”€â”€ xchat-manager/
â”‚   â”œâ”€â”€ xchat-service-admin/
â”‚   â”œâ”€â”€ xchat-service-api/
â”‚   â”œâ”€â”€ xchat-service-common/
â”‚   â”œâ”€â”€ xchat-service-oauth2/
â”‚   â”œâ”€â”€ xchat-service-record/
â”‚   â”œâ”€â”€ xchat-service-task/
â”‚   â”œâ”€â”€ xchat-web-admin/
â”‚   â”œâ”€â”€ xchat-web-api/
â”‚   â”œâ”€â”€ xchat-web-oauth2/
â”‚   â”œâ”€â”€ xchat-web-record/
â”‚   â”œâ”€â”€ xchat-web-task/
â”‚   â””â”€â”€ pom.xml
â”œâ”€â”€ imsvr/                             # Node.js IMæœåŠ¡å™¨
â”‚   â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ libs/
â”‚   â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ im-svr.js
â”‚   â”œâ”€â”€ http-svr.js
â”‚   â”œâ”€â”€ cron-svr.js
â”‚   â”œâ”€â”€ proxy.js
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ pm2.json
â”‚   â”œâ”€â”€ start.sh
â”‚   â”œâ”€â”€ stop.sh
â”‚   â””â”€â”€ restart.sh
â”œâ”€â”€ h5/                                # H5å‰ç«¯é¡µé¢
â”‚   â”œâ”€â”€ front/
â”‚   â”œâ”€â”€ index.html
â”‚   â””â”€â”€ ...
â””â”€â”€ labei.sql                          # æ•°æ®åº“è„šæœ¬
```

#### ğŸ“ æ‰§è¡Œæ­¥éª¤1.2ï¼šç›®å½•ç»“æ„éªŒè¯è„šæœ¬

**Windows éªŒè¯è„šæœ¬ (check-structure.bat):**
```batch
@echo off
echo ========================================
echo æ‹‰è´æ˜Ÿçƒé¡¹ç›®ç›®å½•ç»“æ„æ£€æŸ¥
echo ========================================
echo.

set BASE_DIR=C:\Users\ä¼˜é…ªæ—¶å…‰\Desktop\labei
set ERROR=0

echo [1/4] æ£€æŸ¥ adminbak ç›®å½•...
if not exist "%BASE_DIR%\adminbak\pom.xml" (
    echo âŒ adminbak/pom.xml ä¸å­˜åœ¨ï¼
    set ERROR=1
) else (
    echo âœ… adminbak ç›®å½•ç»“æ„æ­£ç¡®
)

echo [2/4] æ£€æŸ¥ apiservice ç›®å½•...
if not exist "%BASE_DIR%\apiservice\pom.xml" (
    echo âŒ apiservice/pom.xml ä¸å­˜åœ¨ï¼
    set ERROR=1
) else (
    echo âœ… apiservice ç›®å½•ç»“æ„æ­£ç¡®
)

echo [3/4] æ£€æŸ¥ imsvr ç›®å½•...
if not exist "%BASE_DIR%\imsvr\package.json" (
    echo âŒ imsvr/package.json ä¸å­˜åœ¨ï¼
    set ERROR=1
) else (
    echo âœ… imsvr ç›®å½•ç»“æ„æ­£ç¡®
)

echo [4/4] æ£€æŸ¥ h5 ç›®å½•...
if not exist "%BASE_DIR%\h5\index.html" (
    echo âŒ h5/index.html ä¸å­˜åœ¨ï¼
    set ERROR=1
) else (
    echo âœ… h5 ç›®å½•ç»“æ„æ­£ç¡®
)

echo.
echo ========================================
if %ERROR%==0 (
    echo âœ… ç›®å½•ç»“æ„æ£€æŸ¥é€šè¿‡ï¼
    exit /b 0
) else (
    echo âŒ ç›®å½•ç»“æ„æ£€æŸ¥å¤±è´¥ï¼
    exit /b 1
)
```

---

### 1.3 é…ç½®æ–‡ä»¶é¢„å¤„ç†ï¼ˆé¿å…éƒ¨ç½²æ—¶æ‰‹åŠ¨ä¿®æ”¹å‡ºé”™ï¼‰

#### âœ… é…ç½®æ–‡ä»¶æ¸…å•ï¼ˆéœ€è¦ä¿®æ”¹çš„æ–‡ä»¶ï¼‰

| æ–‡ä»¶è·¯å¾„ | é…ç½®é¡¹ | é»˜è®¤å€¼ | éœ€è¦ä¿®æ”¹ä¸º |
|---------|--------|--------|-----------|
| `adminbak/xchat-web/src/main/resources/application-web.properties` | `write.erban.main.jdbc.password` | `yumg@JuXiao.2018&**` | ä½ çš„MySQLå¯†ç  |
| `adminbak/xchat-web/src/main/resources/application-web.properties` | `redis.default.password` | `å¯†ç 2018dev` | ä½ çš„Rediså¯†ç  |
| `apiservice/pom.xml` | `spring.datasource.master.password` | å ä½ç¬¦ | ä½ çš„MySQLå¯†ç  |
| `apiservice/pom.xml` | `spring.redis.password` | å ä½ç¬¦ | ä½ çš„Rediså¯†ç  |
| `imsvr/config/development.js` | `mysqlServers[0].password` | `mysqlå¯†ç¢¼` | ä½ çš„MySQLå¯†ç  |
| `imsvr/config/development.js` | `redis.options.auth_pass` | `rediså¯†ç¢¼` | ä½ çš„Rediså¯†ç  |
| `imsvr/config/development.js` | `mongo.options.pass` | `kjhDh38273erdfEd` | ä½ çš„MongoDBå¯†ç  |

#### ğŸ“ æ‰§è¡Œæ­¥éª¤1.3ï¼šé…ç½®æ–‡ä»¶æ‰¹é‡æ›¿æ¢è„šæœ¬

**é…ç½®å‚æ•°æ–‡ä»¶ (config-params.txt):**
```ini
# æ•°æ®åº“é…ç½®
MYSQL_HOST=127.0.0.1
MYSQL_PORT=3306
MYSQL_DATABASE=labei
MYSQL_USERNAME=root
MYSQL_PASSWORD=ä½ çš„MySQLå¯†ç 

# Redisé…ç½®
REDIS_HOST=127.0.0.1
REDIS_PORT=6379
REDIS_PASSWORD=ä½ çš„Rediså¯†ç 

# MongoDBé…ç½®
MONGO_HOST=127.0.0.1
MONGO_PORT=27017
MONGO_DATABASE=artqiyi
MONGO_USERNAME=artqiyi
MONGO_PASSWORD=kjhDh38273erdfEd

# åŸŸåé…ç½®
SERVER_DOMAIN=http://ä½ çš„åŸŸå
IM_SERVER_HOST=http://127.0.0.1:81
```

**é…ç½®æ›¿æ¢è„šæœ¬ (apply-config.sh):**
```bash
#!/bin/bash

# è¯»å–é…ç½®å‚æ•°
source config-params.txt

echo "========================================
echo "åº”ç”¨é…ç½®å‚æ•°åˆ°æ‰€æœ‰é…ç½®æ–‡ä»¶"
echo "========================================"

# 1. æ›¿æ¢ adminbak é…ç½®
echo "[1/3] é…ç½® adminbak..."
sed -i "s/write.erban.main.jdbc.password=.*/write.erban.main.jdbc.password=$MYSQL_PASSWORD/" \
    adminbak/xchat-web/src/main/resources/application-web.properties

sed -i "s/redis.default.password=.*/redis.default.password=$REDIS_PASSWORD/" \
    adminbak/xchat-web/src/main/resources/application-web.properties

# 2. æ›¿æ¢ apiservice é…ç½®
echo "[2/3] é…ç½® apiservice..."
sed -i "s/<spring.datasource.master.password>.*<\/spring.datasource.master.password>/<spring.datasource.master.password><![CDATA[$MYSQL_PASSWORD]]><\/spring.datasource.master.password>/" \
    apiservice/pom.xml

sed -i "s/<spring.redis.password>.*<\/spring.redis.password>/<spring.redis.password><![CDATA[$REDIS_PASSWORD]]><\/spring.redis.password>/" \
    apiservice/pom.xml

# 3. æ›¿æ¢ imsvr é…ç½®
echo "[3/3] é…ç½® imsvr..."
sed -i "s/password: '.*' \/\/ MySQL/password: '$MYSQL_PASSWORD' \/\/ MySQL/" \
    imsvr/config/development.js

sed -i "s/auth_pass: '.*'/auth_pass: '$REDIS_PASSWORD'/" \
    imsvr/config/development.js

echo "âœ… é…ç½®æ–‡ä»¶æ›¿æ¢å®Œæˆï¼"
```

---

## ğŸš€ é˜¶æ®µ2: æºç éƒ¨ç½²ï¼ˆåˆ†æ¨¡å—é€ä¸ªéªŒè¯ï¼‰

### 2.1 æ•°æ®åº“éƒ¨ç½²ä¸éªŒè¯

#### âœ… æ•°æ®åº“åˆå§‹åŒ–æ­¥éª¤

**æ­¥éª¤2.1.1ï¼šåˆ›å»ºæ•°æ®åº“**

```sql
-- è¿æ¥ MySQL
mysql -uroot -pä½ çš„MySQLå¯†ç 

-- åˆ›å»ºæ•°æ®åº“
CREATE DATABASE labei DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE DATABASE yingtao DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- éªŒè¯æ•°æ®åº“åˆ›å»º
SHOW DATABASES LIKE '%labei%';
SHOW DATABASES LIKE '%yingtao%';

-- é€€å‡º
EXIT;
```

**æ­¥éª¤2.1.2ï¼šå¯¼å…¥æ•°æ®åº“è„šæœ¬**

```bash
# Windows
mysql -uroot -pä½ çš„MySQLå¯†ç  labei < C:\Users\ä¼˜é…ªæ—¶å…‰\Desktop\labei\labei.sql

# Linux
mysql -uroot -pä½ çš„MySQLå¯†ç  labei < /path/to/labei/labei.sql
```

**æ­¥éª¤2.1.3ï¼šéªŒè¯æ•°æ®åº“è¡¨ç»“æ„**

```sql
-- è¿æ¥æ•°æ®åº“
mysql -uroot -pä½ çš„MySQLå¯†ç  labei

-- æŸ¥çœ‹æ‰€æœ‰è¡¨
SHOW TABLES;

-- éªŒè¯æ ¸å¿ƒè¡¨æ˜¯å¦å­˜åœ¨
SELECT COUNT(*) AS table_count FROM information_schema.tables
WHERE table_schema = 'labei';

-- éªŒè¯ç”¨æˆ·è¡¨ç»“æ„
DESC users;

-- éªŒè¯æˆ¿é—´è¡¨ç»“æ„
DESC room;

-- éªŒè¯ç¤¼ç‰©è¡¨ç»“æ„
DESC gift;

-- æŸ¥çœ‹è¡¨æ•°é‡ï¼ˆåº”è¯¥æœ‰50+å¼ è¡¨ï¼‰
SELECT COUNT(*) FROM information_schema.tables WHERE table_schema = 'labei';
```

**âœ… éªŒè¯æ¸…å•ï¼š**
- [ ] labei æ•°æ®åº“åˆ›å»ºæˆåŠŸ
- [ ] yingtao æ•°æ®åº“åˆ›å»ºæˆåŠŸï¼ˆå¦‚éœ€è¦ï¼‰
- [ ] æ•°æ®åº“è¡¨æ•°é‡ >= 50
- [ ] users è¡¨å­˜åœ¨ä¸”å­—æ®µå®Œæ•´
- [ ] room è¡¨å­˜åœ¨ä¸”å­—æ®µå®Œæ•´
- [ ] gift è¡¨å­˜åœ¨ä¸”å­—æ®µå®Œæ•´

#### âœ… Redis é…ç½®éªŒè¯

```bash
# è¿æ¥ Redis
redis-cli -a ä½ çš„Rediså¯†ç 

# æµ‹è¯•è¿æ¥
PING
# åº”è¿”å›: PONG

# æŸ¥çœ‹æ•°æ®åº“
INFO keyspace

# æµ‹è¯•å†™å…¥
SET test_key "test_value"
GET test_key
DEL test_key

# é€€å‡º
EXIT
```

**âœ… éªŒè¯æ¸…å•ï¼š**
- [ ] Redis è¿æ¥æˆåŠŸ
- [ ] PING è¿”å› PONG
- [ ] å¯ä»¥æ­£å¸¸è¯»å†™æ•°æ®

#### âœ… MongoDB é…ç½®éªŒè¯

```bash
# è¿æ¥ MongoDB
mongo -u artqiyi -p kjhDh38273erdfEd --authenticationDatabase artqiyi

# æŸ¥çœ‹æ•°æ®åº“
show dbs

# åˆ‡æ¢åˆ° artqiyi æ•°æ®åº“
use artqiyi

# æŸ¥çœ‹é›†åˆ
show collections

# é€€å‡º
exit
```

**âœ… éªŒè¯æ¸…å•ï¼š**
- [ ] MongoDB è¿æ¥æˆåŠŸ
- [ ] artqiyi æ•°æ®åº“å­˜åœ¨
- [ ] å¯ä»¥æ­£å¸¸è®¿é—®é›†åˆ

---

### 2.2 åç«¯æœåŠ¡éƒ¨ç½²ä¸éªŒè¯

#### âœ… adminbak æ¨¡å—éƒ¨ç½²ï¼ˆæ—§ç‰ˆSpring MVCï¼‰

**æ­¥éª¤2.2.1ï¼šç¼–è¯‘ adminbak**

```bash
cd C:\Users\ä¼˜é…ªæ—¶å…‰\Desktop\labei\adminbak

# æ¸…ç†å¹¶ç¼–è¯‘
mvn clean package -DskipTests

# ç­‰å¾…ç¼–è¯‘å®Œæˆï¼ˆçº¦3-5åˆ†é’Ÿï¼‰
# æˆåŠŸæ ‡å¿—: BUILD SUCCESS
```

**âœ… ç¼–è¯‘éªŒè¯æ¸…å•ï¼š**
- [ ] ç¼–è¯‘æ— é”™è¯¯
- [ ] æ˜¾ç¤º BUILD SUCCESS
- [ ] ç”Ÿæˆ WAR æ–‡ä»¶ï¼š
  - [ ] `xchat-admin-web/target/ROOT.war`
  - [ ] `xchat-web/target/ROOT.war`
  - [ ] `xchat-oauth2-web/target/ROOT.war`

**æ­¥éª¤2.2.2ï¼šéƒ¨ç½²åˆ° Tomcatï¼ˆå¯é€‰ï¼‰**

```bash
# ä¸‹è½½ Tomcat 8.5
# https://tomcat.apache.org/download-80.cgi

# å¤åˆ¶ WAR æ–‡ä»¶åˆ° Tomcat
copy adminbak\xchat-web\target\ROOT.war C:\apache-tomcat-8.5\webapps\

# å¯åŠ¨ Tomcat
cd C:\apache-tomcat-8.5\bin
startup.bat

# æŸ¥çœ‹æ—¥å¿—
tail -f C:\apache-tomcat-8.5\logs\catalina.out
```

**âœ… éƒ¨ç½²éªŒè¯æ¸…å•ï¼š**
- [ ] Tomcat å¯åŠ¨æˆåŠŸ
- [ ] æ—¥å¿—æ— é”™è¯¯
- [ ] è®¿é—® http://localhost:8080 æ­£å¸¸

---

#### âœ… apiservice æ¨¡å—éƒ¨ç½²ï¼ˆæ–°ç‰ˆSpring Bootï¼‰

**æ­¥éª¤2.2.3ï¼šç¼–è¯‘ apiservice**

```bash
cd C:\Users\ä¼˜é…ªæ—¶å…‰\Desktop\labei\apiservice

# ä½¿ç”¨ local ç¯å¢ƒç¼–è¯‘
mvn clean package -Plocal -DskipTests

# ç­‰å¾…ç¼–è¯‘å®Œæˆï¼ˆçº¦5-8åˆ†é’Ÿï¼‰
# æˆåŠŸæ ‡å¿—: BUILD SUCCESS
```

**âœ… ç¼–è¯‘éªŒè¯æ¸…å•ï¼š**
- [ ] ç¼–è¯‘æ— é”™è¯¯
- [ ] æ˜¾ç¤º BUILD SUCCESS
- [ ] ç”Ÿæˆ JAR æ–‡ä»¶ï¼š
  - [ ] `xchat-web-api/target/appservice.jar`
  - [ ] `xchat-web-admin/target/appservice-admin.jar`
  - [ ] `xchat-web-oauth2/target/appservice-oauth2.jar`
  - [ ] `xchat-web-record/target/appservice-record.jar`
  - [ ] `xchat-web-task/target/appservice-task.jar`

**æ­¥éª¤2.2.4ï¼šå¯åŠ¨ API æœåŠ¡**

```bash
# å¯åŠ¨ä¸» API æœåŠ¡
cd C:\Users\ä¼˜é…ªæ—¶å…‰\Desktop\labei\apiservice\xchat-web-api\target
java -jar appservice.jar --server.port=8080

# ç­‰å¾…å¯åŠ¨å®Œæˆï¼ˆçº¦30ç§’ï¼‰
# æˆåŠŸæ ‡å¿—: Started XchatWebApiApplication in X seconds
```

**æ­¥éª¤2.2.5ï¼šéªŒè¯ API æœåŠ¡**

```bash
# æ–¹æ³•1: è®¿é—® Swagger æ–‡æ¡£
# æµè§ˆå™¨æ‰“å¼€: http://localhost:8080/swagger-ui.html

# æ–¹æ³•2: æµ‹è¯•å¥åº·æ£€æŸ¥æ¥å£
curl http://localhost:8080/actuator/health

# æ–¹æ³•3: æµ‹è¯•ç”¨æˆ·ç™»å½•æ¥å£
curl -X POST http://localhost:8080/user/login \
  -H "Content-Type: application/json" \
  -d '{"phone":"13800138000","password":"123456"}'
```

**âœ… APIæœåŠ¡éªŒè¯æ¸…å•ï¼š**
- [ ] æœåŠ¡å¯åŠ¨æˆåŠŸ
- [ ] Swagger æ–‡æ¡£å¯è®¿é—®
- [ ] å¥åº·æ£€æŸ¥æ¥å£è¿”å› UP
- [ ] ç™»å½•æ¥å£è¿”å›æ­£ç¡®æ ¼å¼ï¼ˆå³ä½¿å¤±è´¥ä¹Ÿåº”è¿”å›JSONï¼‰

**æ­¥éª¤2.2.6ï¼šå¯åŠ¨å…¶ä»–æœåŠ¡ï¼ˆå¯é€‰ï¼‰**

```bash
# å¯åŠ¨ç®¡ç†åå°æœåŠ¡
cd C:\Users\ä¼˜é…ªæ—¶å…‰\Desktop\labei\apiservice\xchat-web-admin\target
start java -jar appservice-admin.jar --server.port=8081

# å¯åŠ¨ OAuth2 æœåŠ¡
cd C:\Users\ä¼˜é…ªæ—¶å…‰\Desktop\labei\apiservice\xchat-web-oauth2\target
start java -jar appservice-oauth2.jar --server.port=8082

# å¯åŠ¨è®°å½•ç»Ÿè®¡æœåŠ¡
cd C:\Users\ä¼˜é…ªæ—¶å…‰\Desktop\labei\apiservice\xchat-web-record\target
start java -jar appservice-record.jar --server.port=8083

# å¯åŠ¨å®šæ—¶ä»»åŠ¡æœåŠ¡
cd C:\Users\ä¼˜é…ªæ—¶å…‰\Desktop\labei\apiservice\xchat-web-task\target
start java -jar appservice-task.jar --server.port=8084
```

**âœ… æ‰€æœ‰æœåŠ¡éªŒè¯æ¸…å•ï¼š**
- [ ] APIæœåŠ¡ (8080) è¿è¡Œä¸­
- [ ] ç®¡ç†åå° (8081) è¿è¡Œä¸­
- [ ] OAuth2æœåŠ¡ (8082) è¿è¡Œä¸­
- [ ] è®°å½•æœåŠ¡ (8083) è¿è¡Œä¸­
- [ ] ä»»åŠ¡æœåŠ¡ (8084) è¿è¡Œä¸­

---

### 2.3 IMæœåŠ¡å™¨éƒ¨ç½²ä¸éªŒè¯

#### âœ… imsvr æ¨¡å—éƒ¨ç½²ï¼ˆNode.jsï¼‰

**æ­¥éª¤2.3.1ï¼šå®‰è£…ä¾èµ–**

```bash
cd C:\Users\ä¼˜é…ªæ—¶å…‰\Desktop\labei\imsvr

# å®‰è£… Node.js ä¾èµ–
npm install

# å¦‚æœé‡åˆ°ä¾èµ–é—®é¢˜
npm install --legacy-peer-deps

# ç­‰å¾…å®‰è£…å®Œæˆï¼ˆçº¦2-5åˆ†é’Ÿï¼‰
```

**âœ… ä¾èµ–å®‰è£…éªŒè¯æ¸…å•ï¼š**
- [ ] npm install æˆåŠŸ
- [ ] node_modules ç›®å½•å­˜åœ¨
- [ ] æ— ä¸¥é‡é”™è¯¯ï¼ˆè­¦å‘Šå¯å¿½ç•¥ï¼‰

**æ­¥éª¤2.3.2ï¼šå¯åŠ¨ IM æœåŠ¡**

```bash
# Windows å¯åŠ¨
cd C:\Users\ä¼˜é…ªæ—¶å…‰\Desktop\labei\imsvr

# å¯åŠ¨ IM WebSocket æœåŠ¡ï¼ˆç«¯å£ 3000ï¼‰
pm2 start im-svr.js --name "im-svr-3000" -- 3000

# å¯åŠ¨ HTTP API æœåŠ¡ï¼ˆç«¯å£ 3001ï¼‰
pm2 start http-svr.js --name "http-svr-3001" -- 3000

# å¯åŠ¨å®šæ—¶ä»»åŠ¡æœåŠ¡ï¼ˆç«¯å£ 3003ï¼‰
pm2 start cron-svr.js --name "cron-svr-3003" -- 3000

# æŸ¥çœ‹è¿è¡ŒçŠ¶æ€
pm2 list

# æŸ¥çœ‹æ—¥å¿—
pm2 logs
```

**æ­¥éª¤2.3.3ï¼šéªŒè¯ IM æœåŠ¡**

```bash
# æ–¹æ³•1: æ£€æŸ¥è¿›ç¨‹
pm2 list
# åº”æ˜¾ç¤º 3 ä¸ªè¿›ç¨‹éƒ½åœ¨è¿è¡Œ

# æ–¹æ³•2: æµ‹è¯• HTTP æ¥å£
curl http://localhost:3001

# æ–¹æ³•3: æµ‹è¯• WebSocket è¿æ¥ï¼ˆä½¿ç”¨æµè§ˆå™¨æ§åˆ¶å°ï¼‰
# æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼Œæ‰§è¡Œï¼š
var socket = io('http://localhost:3000');
socket.on('connect', function() {
    console.log('IMæœåŠ¡å™¨è¿æ¥æˆåŠŸï¼');
});
```

**âœ… IMæœåŠ¡éªŒè¯æ¸…å•ï¼š**
- [ ] im-svr-3000 è¿›ç¨‹è¿è¡Œä¸­
- [ ] http-svr-3001 è¿›ç¨‹è¿è¡Œä¸­
- [ ] cron-svr-3003 è¿›ç¨‹è¿è¡Œä¸­
- [ ] HTTP æ¥å£å¯è®¿é—®
- [ ] WebSocket è¿æ¥æˆåŠŸ

---

### 2.4 å‰ç«¯H5éƒ¨ç½²ä¸éªŒè¯

#### âœ… H5 å‰ç«¯éƒ¨ç½²

**æ­¥éª¤2.4.1ï¼šé…ç½® API åœ°å€**

ç¼–è¾‘æ–‡ä»¶ï¼š`h5/front/lib/api.js`

```javascript
// ä¿®æ”¹ API åœ°å€
const formalUrl = "http://localhost:8080"
const formalUrl1 = "http://localhost:8080"
const baseUrl = 'http://localhost:8080'
```

**æ­¥éª¤2.4.2ï¼šéƒ¨ç½²åˆ° Nginx**

```bash
# Windows
# 1. å¤åˆ¶ h5 ç›®å½•åˆ° Nginx
xcopy /E /I C:\Users\ä¼˜é…ªæ—¶å…‰\Desktop\labei\h5 C:\nginx\html\h5

# 2. é…ç½® Nginx
# ç¼–è¾‘ C:\nginx\conf\nginx.conf
```

**Nginx é…ç½®æ–‡ä»¶ï¼š**

```nginx
server {
    listen 80;
    server_name localhost;

    # H5 é¡µé¢
    location / {
        root html/h5;
        index index.html;
        try_files $uri $uri/ /index.html;
    }

    # API ä»£ç†
    location /api/ {
        proxy_pass http://127.0.0.1:8080/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    # IM æœåŠ¡ä»£ç†
    location /im/ {
        proxy_pass http://127.0.0.1:3001/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }
}
```

**æ­¥éª¤2.4.3ï¼šå¯åŠ¨ Nginx**

```bash
# Windows
cd C:\nginx
nginx.exe

# æˆ–é‡å¯ Nginx
nginx.exe -s reload
```

**æ­¥éª¤2.4.4ï¼šéªŒè¯ H5 é¡µé¢**

```bash
# æµè§ˆå™¨è®¿é—®
http://localhost

# æ£€æŸ¥é¡µé¢å…ƒç´ 
# 1. é¡µé¢æ­£å¸¸åŠ è½½
# 2. æ—  404 é”™è¯¯
# 3. API è°ƒç”¨æ­£å¸¸
# 4. é™æ€èµ„æºåŠ è½½æ­£å¸¸
```

**âœ… H5éƒ¨ç½²éªŒè¯æ¸…å•ï¼š**
- [ ] Nginx å¯åŠ¨æˆåŠŸ
- [ ] è®¿é—® http://localhost æ˜¾ç¤ºé¦–é¡µ
- [ ] é¡µé¢æ—  404 é”™è¯¯
- [ ] API è°ƒç”¨æ­£å¸¸
- [ ] é™æ€èµ„æºï¼ˆå›¾ç‰‡ã€CSSã€JSï¼‰åŠ è½½æ­£å¸¸

---

## ğŸ” é˜¶æ®µ3: åŒ¹é…åº¦éªŒè¯ï¼ˆå…¨æµç¨‹æ ¡éªŒï¼‰

### 3.1 ç›®å½•ç»“æ„1:1æ ¡éªŒ

#### âœ… ç›®å½•æ ‘å¯¹æ¯”è„šæœ¬

**Windows ç›®å½•æ ‘å¯¼å‡º (export-tree.bat):**

```batch
@echo off
echo å¯¼å‡ºç›®å½•æ ‘...

cd C:\Users\ä¼˜é…ªæ—¶å…‰\Desktop\labei

tree /F /A > directory-tree.txt

echo âœ… ç›®å½•æ ‘å·²å¯¼å‡ºåˆ° directory-tree.txt
```

**Linux ç›®å½•æ ‘å¯¼å‡º (export-tree.sh):**

```bash
#!/bin/bash

cd /path/to/labei

tree -a -L 3 > directory-tree.txt

echo "âœ… ç›®å½•æ ‘å·²å¯¼å‡ºåˆ° directory-tree.txt"
```

**âœ… ç›®å½•ç»“æ„éªŒè¯æ¸…å•ï¼š**
- [ ] adminbak ç›®å½•å®Œæ•´ï¼ˆ7ä¸ªå­æ¨¡å—ï¼‰
- [ ] apiservice ç›®å½•å®Œæ•´ï¼ˆ14ä¸ªå­æ¨¡å—ï¼‰
- [ ] imsvr ç›®å½•å®Œæ•´ï¼ˆconfigã€libsã€routesç­‰ï¼‰
- [ ] h5 ç›®å½•å®Œæ•´ï¼ˆfrontã€index.htmlç­‰ï¼‰
- [ ] labei.sql æ–‡ä»¶å­˜åœ¨
- [ ] æ— å¤šä½™æ–‡ä»¶å¤¹
- [ ] æ— ç¼ºå¤±æ–‡ä»¶å¤¹

---

### 3.2 åŠŸèƒ½å®Œæ•´æ€§æµ‹è¯•

#### âœ… æ ¸å¿ƒæµç¨‹æµ‹è¯•è„šæœ¬

**æµ‹è¯•ç”¨ä¾‹1ï¼šç”¨æˆ·æ³¨å†Œ-ç™»å½•æµç¨‹**

```bash
# 1. ç”¨æˆ·æ³¨å†Œ
curl -X POST http://localhost:8080/user/register \
  -H "Content-Type: application/json" \
  -d '{
    "phone": "13800138000",
    "password": "123456",
    "code": "1234"
  }'

# é¢„æœŸç»“æœ: è¿”å›æˆåŠŸæˆ–æ‰‹æœºå·å·²å­˜åœ¨

# 2. ç”¨æˆ·ç™»å½•
curl -X POST http://localhost:8080/user/login \
  -H "Content-Type: application/json" \
  -d '{
    "phone": "13800138000",
    "password": "123456"
  }'

# é¢„æœŸç»“æœ: è¿”å› token å’Œç”¨æˆ·ä¿¡æ¯

# 3. è·å–ç”¨æˆ·ä¿¡æ¯
curl -X GET http://localhost:8080/user/info \
  -H "Authorization: Bearer <token>"

# é¢„æœŸç»“æœ: è¿”å›ç”¨æˆ·è¯¦ç»†ä¿¡æ¯
```

**æµ‹è¯•ç”¨ä¾‹2ï¼šæˆ¿é—´åˆ›å»º-è¿›å…¥æµç¨‹**

```bash
# 1. åˆ›å»ºæˆ¿é—´
curl -X POST http://localhost:8080/room/create \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "æµ‹è¯•æˆ¿é—´",
    "type": 1
  }'

# é¢„æœŸç»“æœ: è¿”å›æˆ¿é—´ID

# 2. è·å–æˆ¿é—´åˆ—è¡¨
curl -X GET http://localhost:8080/room/list

# é¢„æœŸç»“æœ: è¿”å›æˆ¿é—´åˆ—è¡¨ï¼ŒåŒ…å«åˆšåˆ›å»ºçš„æˆ¿é—´

# 3. è¿›å…¥æˆ¿é—´
curl -X POST http://localhost:8080/room/enter \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{
    "roomId": <room_id>
  }'

# é¢„æœŸç»“æœ: è¿”å›æˆ¿é—´è¯¦æƒ…å’Œéº¦ä½ä¿¡æ¯
```

**æµ‹è¯•ç”¨ä¾‹3ï¼šç¤¼ç‰©å‘é€æµç¨‹**

```bash
# 1. è·å–ç¤¼ç‰©åˆ—è¡¨
curl -X GET http://localhost:8080/gift/list

# é¢„æœŸç»“æœ: è¿”å›ç¤¼ç‰©åˆ—è¡¨

# 2. å‘é€ç¤¼ç‰©
curl -X POST http://localhost:8080/gift/send \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{
    "roomId": <room_id>,
    "giftId": 1,
    "num": 1
  }'

# é¢„æœŸç»“æœ: è¿”å›å‘é€æˆåŠŸ
```

**âœ… åŠŸèƒ½å®Œæ•´æ€§éªŒè¯æ¸…å•ï¼š**
- [ ] ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½æ­£å¸¸
- [ ] ç”¨æˆ·ç™»å½•åŠŸèƒ½æ­£å¸¸
- [ ] è·å–ç”¨æˆ·ä¿¡æ¯æ­£å¸¸
- [ ] åˆ›å»ºæˆ¿é—´åŠŸèƒ½æ­£å¸¸
- [ ] è·å–æˆ¿é—´åˆ—è¡¨æ­£å¸¸
- [ ] è¿›å…¥æˆ¿é—´åŠŸèƒ½æ­£å¸¸
- [ ] è·å–ç¤¼ç‰©åˆ—è¡¨æ­£å¸¸
- [ ] å‘é€ç¤¼ç‰©åŠŸèƒ½æ­£å¸¸
- [ ] IM å®æ—¶é€šä¿¡æ­£å¸¸
- [ ] æ’è¡Œæ¦œåŠŸèƒ½æ­£å¸¸

---

### 3.3 ä¸€é”®è„šæœ¬å¤ç”¨æ€§æµ‹è¯•

#### âœ… ä¸€é”®éƒ¨ç½²è„šæœ¬ï¼ˆå®Œæ•´ç‰ˆï¼‰

**Windows ä¸€é”®éƒ¨ç½²è„šæœ¬ (deploy-all.bat):**

```batch
@echo off
echo ========================================
echo æ‹‰è´æ˜Ÿçƒé¡¹ç›®ä¸€é”®éƒ¨ç½²è„šæœ¬
echo ========================================
echo.

set BASE_DIR=C:\Users\ä¼˜é…ªæ—¶å…‰\Desktop\labei

echo [æ­¥éª¤1/7] æ£€æŸ¥ç¯å¢ƒä¾èµ–...
call check-env.bat
if errorlevel 1 (
    echo âŒ ç¯å¢ƒæ£€æŸ¥å¤±è´¥ï¼è¯·å…ˆå®‰è£…ä¾èµ–
    exit /b 1
)
echo.

echo [æ­¥éª¤2/7] åˆå§‹åŒ–æ•°æ®åº“...
mysql -uroot -pä½ çš„MySQLå¯†ç  < %BASE_DIR%\init-database.sql
if errorlevel 1 (
    echo âŒ æ•°æ®åº“åˆå§‹åŒ–å¤±è´¥ï¼
    exit /b 1
)
echo âœ… æ•°æ®åº“åˆå§‹åŒ–å®Œæˆ
echo.

echo [æ­¥éª¤3/7] ç¼–è¯‘ apiservice...
cd %BASE_DIR%\apiservice
call mvn clean package -Plocal -DskipTests
if errorlevel 1 (
    echo âŒ apiservice ç¼–è¯‘å¤±è´¥ï¼
    exit /b 1
)
echo âœ… apiservice ç¼–è¯‘å®Œæˆ
echo.

echo [æ­¥éª¤4/7] å®‰è£… imsvr ä¾èµ–...
cd %BASE_DIR%\imsvr
call npm install --legacy-peer-deps
if errorlevel 1 (
    echo âŒ imsvr ä¾èµ–å®‰è£…å¤±è´¥ï¼
    exit /b 1
)
echo âœ… imsvr ä¾èµ–å®‰è£…å®Œæˆ
echo.

echo [æ­¥éª¤5/7] å¯åŠ¨ API æœåŠ¡...
cd %BASE_DIR%\apiservice\xchat-web-api\target
start /b java -jar appservice.jar --server.port=8080
timeout /t 30
echo âœ… API æœåŠ¡å¯åŠ¨å®Œæˆ
echo.

echo [æ­¥éª¤6/7] å¯åŠ¨ IM æœåŠ¡...
cd %BASE_DIR%\imsvr
pm2 start im-svr.js --name "im-svr" -- 3000
pm2 start http-svr.js --name "http-svr" -- 3000
echo âœ… IM æœåŠ¡å¯åŠ¨å®Œæˆ
echo.

echo [æ­¥éª¤7/7] å¯åŠ¨ Nginx...
cd C:\nginx
start nginx.exe
echo âœ… Nginx å¯åŠ¨å®Œæˆ
echo.

echo ========================================
echo âœ… æ‰€æœ‰æœåŠ¡éƒ¨ç½²å®Œæˆï¼
echo ========================================
echo APIæœåŠ¡: http://localhost:8080
echo IMæœåŠ¡: http://localhost:3001
echo H5é¡µé¢: http://localhost
echo ========================================
pause
```

**Linux ä¸€é”®éƒ¨ç½²è„šæœ¬ (deploy-all.sh):**

```bash
#!/bin/bash

BASE_DIR="/path/to/labei"

echo "========================================"
echo "æ‹‰è´æ˜Ÿçƒé¡¹ç›®ä¸€é”®éƒ¨ç½²è„šæœ¬"
echo "========================================"
echo ""

# æ­¥éª¤1: æ£€æŸ¥ç¯å¢ƒ
echo "[æ­¥éª¤1/7] æ£€æŸ¥ç¯å¢ƒä¾èµ–..."
bash check-env.sh
if [ $? -ne 0 ]; then
    echo "âŒ ç¯å¢ƒæ£€æŸ¥å¤±è´¥ï¼è¯·å…ˆå®‰è£…ä¾èµ–"
    exit 1
fi
echo ""

# æ­¥éª¤2: åˆå§‹åŒ–æ•°æ®åº“
echo "[æ­¥éª¤2/7] åˆå§‹åŒ–æ•°æ®åº“..."
mysql -uroot -pä½ çš„MySQLå¯†ç  < $BASE_DIR/init-database.sql
if [ $? -ne 0 ]; then
    echo "âŒ æ•°æ®åº“åˆå§‹åŒ–å¤±è´¥ï¼"
    exit 1
fi
echo "âœ… æ•°æ®åº“åˆå§‹åŒ–å®Œæˆ"
echo ""

# æ­¥éª¤3: ç¼–è¯‘ apiservice
echo "[æ­¥éª¤3/7] ç¼–è¯‘ apiservice..."
cd $BASE_DIR/apiservice
mvn clean package -Plocal -DskipTests
if [ $? -ne 0 ]; then
    echo "âŒ apiservice ç¼–è¯‘å¤±è´¥ï¼"
    exit 1
fi
echo "âœ… apiservice ç¼–è¯‘å®Œæˆ"
echo ""

# æ­¥éª¤4: å®‰è£… imsvr ä¾èµ–
echo "[æ­¥éª¤4/7] å®‰è£… imsvr ä¾èµ–..."
cd $BASE_DIR/imsvr
npm install --legacy-peer-deps
if [ $? -ne 0 ]; then
    echo "âŒ imsvr ä¾èµ–å®‰è£…å¤±è´¥ï¼"
    exit 1
fi
echo "âœ… imsvr ä¾èµ–å®‰è£…å®Œæˆ"
echo ""

# æ­¥éª¤5: å¯åŠ¨ API æœåŠ¡
echo "[æ­¥éª¤5/7] å¯åŠ¨ API æœåŠ¡..."
cd $BASE_DIR/apiservice/xchat-web-api/target
nohup java -jar appservice.jar --server.port=8080 > /var/log/labei/api.log 2>&1 &
sleep 30
echo "âœ… API æœåŠ¡å¯åŠ¨å®Œæˆ"
echo ""

# æ­¥éª¤6: å¯åŠ¨ IM æœåŠ¡
echo "[æ­¥éª¤6/7] å¯åŠ¨ IM æœåŠ¡..."
cd $BASE_DIR/imsvr
pm2 start im-svr.js --name "im-svr" -- 3000
pm2 start http-svr.js --name "http-svr" -- 3000
echo "âœ… IM æœåŠ¡å¯åŠ¨å®Œæˆ"
echo ""

# æ­¥éª¤7: å¯åŠ¨ Nginx
echo "[æ­¥éª¤7/7] å¯åŠ¨ Nginx..."
systemctl start nginx
echo "âœ… Nginx å¯åŠ¨å®Œæˆ"
echo ""

echo "========================================"
echo "âœ… æ‰€æœ‰æœåŠ¡éƒ¨ç½²å®Œæˆï¼"
echo "========================================"
echo "APIæœåŠ¡: http://localhost:8080"
echo "IMæœåŠ¡: http://localhost:3001"
echo "H5é¡µé¢: http://localhost"
echo "========================================"
```

**âœ… ä¸€é”®è„šæœ¬éªŒè¯æ¸…å•ï¼š**
- [ ] è„šæœ¬å¯æ‰§è¡Œ
- [ ] ç¯å¢ƒæ£€æŸ¥é€šè¿‡
- [ ] æ•°æ®åº“åˆå§‹åŒ–æˆåŠŸ
- [ ] apiservice ç¼–è¯‘æˆåŠŸ
- [ ] imsvr ä¾èµ–å®‰è£…æˆåŠŸ
- [ ] API æœåŠ¡å¯åŠ¨æˆåŠŸ
- [ ] IM æœåŠ¡å¯åŠ¨æˆåŠŸ
- [ ] Nginx å¯åŠ¨æˆåŠŸ
- [ ] æ‰€æœ‰æœåŠ¡å¯è®¿é—®

---

## ğŸ“Š æœ€ç»ˆéªŒè¯æŠ¥å‘Š

### âœ… å®Œæ•´éªŒè¯æ¸…å•

#### ç¯å¢ƒå‡†å¤‡é˜¶æ®µ
- [ ] JDK 1.8 å®‰è£…å¹¶éªŒè¯
- [ ] Maven 3.5+ å®‰è£…å¹¶éªŒè¯
- [ ] Node.js 8.x-12.x å®‰è£…å¹¶éªŒè¯
- [ ] MySQL 5.7 å®‰è£…å¹¶éªŒè¯
- [ ] Redis 3.2+ å®‰è£…å¹¶éªŒè¯
- [ ] MongoDB 4.0+ å®‰è£…å¹¶éªŒè¯
- [ ] ActiveMQ 5.15+ å®‰è£…å¹¶éªŒè¯
- [ ] PM2 å®‰è£…å¹¶éªŒè¯
- [ ] ç›®å½•ç»“æ„1:1åŒ¹é…
- [ ] é…ç½®æ–‡ä»¶æ­£ç¡®æ›¿æ¢

#### æºç éƒ¨ç½²é˜¶æ®µ
- [ ] æ•°æ®åº“åˆ›å»ºæˆåŠŸ
- [ ] æ•°æ®åº“è¡¨å¯¼å…¥æˆåŠŸï¼ˆ50+å¼ è¡¨ï¼‰
- [ ] Redis è¿æ¥æ­£å¸¸
- [ ] MongoDB è¿æ¥æ­£å¸¸
- [ ] adminbak ç¼–è¯‘æˆåŠŸ
- [ ] apiservice ç¼–è¯‘æˆåŠŸï¼ˆ5ä¸ªJARæ–‡ä»¶ï¼‰
- [ ] imsvr ä¾èµ–å®‰è£…æˆåŠŸ
- [ ] API æœåŠ¡å¯åŠ¨æˆåŠŸ
- [ ] IM æœåŠ¡å¯åŠ¨æˆåŠŸï¼ˆ3ä¸ªè¿›ç¨‹ï¼‰
- [ ] H5 é¡µé¢éƒ¨ç½²æˆåŠŸ

#### åŒ¹é…åº¦éªŒè¯é˜¶æ®µ
- [ ] ç›®å½•ç»“æ„å®Œå…¨åŒ¹é…
- [ ] ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½æ­£å¸¸
- [ ] ç”¨æˆ·ç™»å½•åŠŸèƒ½æ­£å¸¸
- [ ] æˆ¿é—´åˆ›å»ºåŠŸèƒ½æ­£å¸¸
- [ ] ç¤¼ç‰©å‘é€åŠŸèƒ½æ­£å¸¸
- [ ] IM å®æ—¶é€šä¿¡æ­£å¸¸
- [ ] ä¸€é”®éƒ¨ç½²è„šæœ¬å¯ç”¨
- [ ] æ‰€æœ‰æ¥å£è¿”å›æ ¼å¼æ­£ç¡®

---

## ğŸ¯ æ€»ç»“

æœ¬æ–¹æ¡ˆæä¾›äº†**100% 1:1 åŒ¹é…æºç **çš„éƒ¨ç½²æ–¹æ¡ˆï¼ŒåŒ…æ‹¬ï¼š

1. **ç²¾ç¡®çš„ä¾èµ–ç‰ˆæœ¬æ¸…å•** - ä»æºç  pom.xml å’Œ package.json æå–
2. **å®Œæ•´çš„éªŒè¯è„šæœ¬** - æ¯ä¸ªæ­¥éª¤éƒ½æœ‰éªŒè¯æ¸…å•
3. **åˆ†æ­¥æ‰§è¡Œæµç¨‹** - æ•°æ®åº“ â†’ åç«¯ â†’ IM â†’ å‰ç«¯
4. **ä¸€é”®éƒ¨ç½²è„šæœ¬** - å¯é‡å¤æ‰§è¡Œçš„è‡ªåŠ¨åŒ–è„šæœ¬
5. **è¯¦ç»†çš„æµ‹è¯•ç”¨ä¾‹** - æ ¸å¿ƒåŠŸèƒ½æµç¨‹æµ‹è¯•

**æ‰§è¡Œå»ºè®®ï¼š**
1. ä¸¥æ ¼æŒ‰ç…§ç‰ˆæœ¬è¦æ±‚å®‰è£…ä¾èµ–ï¼ˆä¸è¦ä½¿ç”¨é«˜ç‰ˆæœ¬ï¼‰
2. æ¯å®Œæˆä¸€ä¸ªæ­¥éª¤ï¼Œç«‹å³éªŒè¯
3. é‡åˆ°é—®é¢˜åŠæ—¶å›é€€ï¼Œä¸è¦ç»§ç»­ä¸‹ä¸€æ­¥
4. ä¿å­˜æ‰€æœ‰éªŒè¯ç»“æœå’Œæ—¥å¿—
5. æœ€åä½¿ç”¨ä¸€é”®è„šæœ¬æµ‹è¯•å®Œæ•´æµç¨‹

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0
**æœ€åæ›´æ–°ï¼š** 2025-11-10
**é€‚ç”¨ç‰ˆæœ¬ï¼š** æ‹‰è´æ˜Ÿçƒå®Œæ•´æºç 
**æ‰§è¡Œæ—¶é—´ï¼š** çº¦ 30-60 åˆ†é’Ÿï¼ˆé¦–æ¬¡éƒ¨ç½²ï¼‰

