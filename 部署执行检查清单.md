# 拉贝星球项目部署执行检查清单

> **使用说明：** 请按照此清单逐项检查，确保每一步都完成并验证通过  
> **检查方式：** 在每个完成的项目前打 ✅  
> **执行时间：** 预计 30-60 分钟

---

## 📋 阶段1: 环境准备（预计 15 分钟）

### 1.1 软件环境检查

- [ ] **JDK 1.8** 已安装
  - 验证命令: `java -version`
  - 预期结果: 显示 `1.8.0_xxx`

- [ ] **Maven 3.5+** 已安装
  - 验证命令: `mvn -version`
  - 预期结果: 显示 `Apache Maven 3.x.x`

- [ ] **Node.js 8.x-12.x** 已安装
  - 验证命令: `node -v`
  - 预期结果: 显示 `v10.x.x` 或 `v12.x.x`

- [ ] **npm 6.x+** 已安装
  - 验证命令: `npm -v`
  - 预期结果: 显示 `6.x.x` 或更高

- [ ] **PM2** 已安装
  - 验证命令: `pm2 -v`
  - 预期结果: 显示版本号

### 1.2 数据库服务检查

- [ ] **MySQL 5.7** 服务运行中
  - Windows: `sc query MySQL`
  - Linux: `systemctl status mysqld`
  - 预期结果: 显示 `RUNNING` 或 `active`

- [ ] **Redis 3.2+** 服务运行中
  - Windows: `tasklist | findstr redis`
  - Linux: `systemctl status redis`
  - 预期结果: 显示进程或 `active`

- [ ] **MongoDB 4.0+** 服务运行中
  - Windows: `sc query MongoDB`
  - Linux: `systemctl status mongod`
  - 预期结果: 显示 `RUNNING` 或 `active`

- [ ] **ActiveMQ 5.15+** 服务运行中（可选）
  - 访问: `http://localhost:8161/admin`
  - 预期结果: 显示管理界面

### 1.3 目录结构检查

- [ ] **adminbak** 目录存在
  - 路径: `C:\Users\优酪时光\Desktop\labei\adminbak`
  - 包含: `pom.xml` 和 7 个子模块

- [ ] **apiservice** 目录存在
  - 路径: `C:\Users\优酪时光\Desktop\labei\apiservice`
  - 包含: `pom.xml` 和 14 个子模块

- [ ] **imsvr** 目录存在
  - 路径: `C:\Users\优酪时光\Desktop\labei\imsvr`
  - 包含: `package.json`、`im-svr.js`、`http-svr.js`

- [ ] **h5** 目录存在
  - 路径: `C:\Users\优酪时光\Desktop\labei\h5`
  - 包含: `index.html` 和 `front` 目录

- [ ] **labei.sql** 文件存在
  - 路径: `C:\Users\优酪时光\Desktop\labei\labei.sql`

### 1.4 配置文件准备

- [ ] **config-params.txt** 已修改
  - 路径: `scripts/config-params.txt`
  - 已修改: MySQL密码、Redis密码、域名

- [ ] **apiservice/pom.xml** 配置已检查
  - 已确认: 数据库连接信息
  - 已确认: Redis 连接信息

- [ ] **imsvr/config/development.js** 配置已检查
  - 已确认: MySQL 密码
  - 已确认: Redis 密码
  - 已确认: MongoDB 密码

---

## 📋 阶段2: 数据库初始化（预计 5 分钟）

### 2.1 MySQL 数据库

- [ ] **创建 labei 数据库**
  - 命令: `CREATE DATABASE labei DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;`
  - 验证: `SHOW DATABASES LIKE 'labei';`

- [ ] **导入数据库脚本**
  - 命令: `mysql -uroot -p密码 labei < labei.sql`
  - 验证: `SELECT COUNT(*) FROM information_schema.tables WHERE table_schema = 'labei';`
  - 预期结果: 表数量 >= 50

- [ ] **验证核心表存在**
  - [ ] users 表存在
  - [ ] room 表存在
  - [ ] gift 表存在
  - [ ] account 表存在

### 2.2 Redis 数据库

- [ ] **Redis 连接测试**
  - 命令: `redis-cli -a 密码 PING`
  - 预期结果: 返回 `PONG`

- [ ] **Redis 读写测试**
  - 命令: `redis-cli -a 密码 SET test_key "test_value"`
  - 验证: `redis-cli -a 密码 GET test_key`
  - 预期结果: 返回 `test_value`

### 2.3 MongoDB 数据库

- [ ] **MongoDB 连接测试**
  - 命令: `mongo -u artqiyi -p kjhDh38273erdfEd --authenticationDatabase artqiyi`
  - 预期结果: 成功登录

- [ ] **artqiyi 数据库存在**
  - 命令: `show dbs`
  - 预期结果: 显示 artqiyi 数据库

---

## 📋 阶段3: 后端服务部署（预计 20 分钟）

### 3.1 apiservice 编译

- [ ] **清理旧编译文件**
  - 命令: `cd apiservice && mvn clean`
  - 预期结果: `BUILD SUCCESS`

- [ ] **编译 apiservice**
  - 命令: `mvn package -Plocal -DskipTests`
  - 预期结果: `BUILD SUCCESS`
  - 耗时: 约 5-8 分钟

- [ ] **验证 JAR 文件生成**
  - [ ] `xchat-web-api/target/appservice.jar` 存在
  - [ ] `xchat-web-admin/target/appservice-admin.jar` 存在
  - [ ] `xchat-web-oauth2/target/appservice-oauth2.jar` 存在
  - [ ] `xchat-web-record/target/appservice-record.jar` 存在
  - [ ] `xchat-web-task/target/appservice-task.jar` 存在

### 3.2 API 服务启动

- [ ] **启动主 API 服务**
  - 命令: `java -jar xchat-web-api/target/appservice.jar --server.port=8080`
  - 预期结果: 显示 `Started XchatWebApiApplication`
  - 耗时: 约 30 秒

- [ ] **验证 API 服务**
  - [ ] 访问 `http://localhost:8080/swagger-ui.html` 正常
  - [ ] 访问 `http://localhost:8080/actuator/health` 返回 `{"status":"UP"}`

- [ ] **启动其他服务（可选）**
  - [ ] 管理后台服务 (8081)
  - [ ] OAuth2 服务 (8082)
  - [ ] 记录服务 (8083)
  - [ ] 任务服务 (8084)

---

## 📋 阶段4: IM服务器部署（预计 10 分钟）

### 4.1 imsvr 依赖安装

- [ ] **安装 Node.js 依赖**
  - 命令: `cd imsvr && npm install --legacy-peer-deps`
  - 预期结果: 无严重错误
  - 耗时: 约 2-5 分钟

- [ ] **验证 node_modules 目录**
  - 路径: `imsvr/node_modules`
  - 预期结果: 目录存在且包含大量依赖

### 4.2 IM 服务启动

- [ ] **启动 IM WebSocket 服务**
  - 命令: `pm2 start im-svr.js --name "im-svr-3000" -- 3000`
  - 预期结果: 显示 `online`

- [ ] **启动 HTTP API 服务**
  - 命令: `pm2 start http-svr.js --name "http-svr-3001" -- 3000`
  - 预期结果: 显示 `online`

- [ ] **启动定时任务服务**
  - 命令: `pm2 start cron-svr.js --name "cron-svr-3003" -- 3000`
  - 预期结果: 显示 `online`

- [ ] **验证 IM 服务**
  - 命令: `pm2 list`
  - 预期结果: 3 个进程都显示 `online`
  - [ ] 访问 `http://localhost:3001` 有响应

---

## 📋 阶段5: 前端部署（预计 5 分钟）

### 5.1 H5 配置

- [ ] **修改 API 地址**
  - 文件: `h5/front/lib/api.js`
  - 已修改: `baseUrl = 'http://localhost:8080'`

### 5.2 Nginx 部署

- [ ] **复制 H5 文件到 Nginx**
  - Windows: `xcopy /E /I h5 C:\nginx\html\h5`
  - Linux: `cp -r h5 /usr/share/nginx/html/`

- [ ] **配置 Nginx**
  - 文件: `nginx.conf`
  - 已配置: H5 页面路由
  - 已配置: API 代理
  - 已配置: IM 服务代理

- [ ] **启动 Nginx**
  - Windows: `cd C:\nginx && start nginx`
  - Linux: `systemctl start nginx`

- [ ] **验证 Nginx**
  - [ ] 访问 `http://localhost` 显示 H5 首页
  - [ ] 页面无 404 错误
  - [ ] 静态资源加载正常

---

## 📋 阶段6: 功能验证（预计 5 分钟）

### 6.1 API 接口测试

- [ ] **健康检查接口**
  - 请求: `GET http://localhost:8080/actuator/health`
  - 预期: `{"status":"UP"}`

- [ ] **用户登录接口**
  - 请求: `POST http://localhost:8080/user/login`
  - 参数: `{"phone":"13800138000","password":"123456"}`
  - 预期: 返回 JSON 格式（即使失败）

- [ ] **房间列表接口**
  - 请求: `GET http://localhost:8080/room/list`
  - 预期: 返回房间列表 JSON

- [ ] **礼物列表接口**
  - 请求: `GET http://localhost:8080/gift/list`
  - 预期: 返回礼物列表 JSON

### 6.2 IM 服务测试

- [ ] **HTTP 接口测试**
  - 请求: `GET http://localhost:3001`
  - 预期: 有响应

- [ ] **WebSocket 连接测试**
  - 使用浏览器控制台测试
  - 预期: 连接成功

### 6.3 H5 页面测试

- [ ] **首页加载**
  - 访问: `http://localhost`
  - 预期: 页面正常显示

- [ ] **API 调用**
  - 检查浏览器控制台
  - 预期: 无 CORS 错误

- [ ] **静态资源**
  - 检查图片、CSS、JS
  - 预期: 全部加载成功

---

## 📋 阶段7: 最终验证（预计 5 分钟）

### 7.1 服务状态检查

- [ ] **所有服务运行中**
  - [ ] MySQL 服务
  - [ ] Redis 服务
  - [ ] MongoDB 服务
  - [ ] API 服务 (8080)
  - [ ] IM 服务 (3000-3003)
  - [ ] Nginx 服务 (80)

### 7.2 端口占用检查

- [ ] **端口 8080** - API 服务
  - Windows: `netstat -ano | findstr :8080`
  - Linux: `lsof -i :8080`

- [ ] **端口 3000-3003** - IM 服务
  - 命令: `pm2 list`

- [ ] **端口 80** - Nginx
  - Windows: `netstat -ano | findstr :80`
  - Linux: `lsof -i :80`

### 7.3 日志检查

- [ ] **API 服务日志无错误**
  - 路径: `apiservice/xchat-web-api/logs/`
  - 检查: 无 ERROR 级别日志

- [ ] **IM 服务日志无错误**
  - 命令: `pm2 logs`
  - 检查: 无严重错误

- [ ] **Nginx 日志无错误**
  - 路径: `/var/log/nginx/error.log`
  - 检查: 无严重错误

---

## ✅ 部署完成确认

### 最终检查清单

- [ ] ✅ 所有环境依赖已安装
- [ ] ✅ 数据库初始化成功（50+张表）
- [ ] ✅ API 服务编译并启动成功
- [ ] ✅ IM 服务安装并启动成功（3个进程）
- [ ] ✅ H5 页面部署成功
- [ ] ✅ 所有接口测试通过
- [ ] ✅ 所有服务日志无严重错误

### 访问地址确认

- [ ] ✅ API 文档: http://localhost:8080/swagger-ui.html
- [ ] ✅ 健康检查: http://localhost:8080/actuator/health
- [ ] ✅ IM 服务: http://localhost:3001
- [ ] ✅ H5 首页: http://localhost

---

## 🎉 恭喜！部署成功！

如果以上所有项目都已完成并验证通过，说明您已经成功完成了拉贝星球项目的 1:1 部署！

### 下一步建议

1. **性能优化** - 参考《1:1搭建部署方案》附录E
2. **安全加固** - 参考《1:1搭建部署方案》附录G
3. **监控配置** - 参考《1:1搭建部署方案》附录F
4. **备份策略** - 参考《1:1搭建部署方案》附录H

---

## 📞 遇到问题？

如果某个步骤未通过，请：

1. 查看对应的错误日志
2. 参考《1:1搭建部署方案》的"常见问题"章节
3. 检查配置文件是否正确
4. 确认所有依赖版本是否匹配

---

**文档版本：** v1.0  
**最后更新：** 2025-11-10  
**预计执行时间：** 30-60 分钟

