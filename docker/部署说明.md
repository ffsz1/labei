# 拉贝星球 Docker 一键部署脚本 v2.0

## ⚡ 快速开始

### 执行命令（唯一需要的命令）

```bash
chmod +x labei-docker-deploy.sh && ./labei-docker-deploy.sh
```

**就这么简单！** 脚本会自动完成所有13个步骤，无需任何手动操作。

---

## 📋 脚本功能

脚本会自动执行以下操作：

1. ✅ 检查系统依赖（Docker、Git、Node.js、npm）
2. ✅ 清理旧环境
3. ✅ 从 GitHub 拉取源码（https://github.com/ffsz1/labei.git）
4. ✅ 创建 docker-compose.yml（版本已固化）
5. ✅ 创建 nginx.conf（完整配置）
6. ✅ 创建 labei.sql（6张核心表）
7. ✅ 创建 apiservice/Dockerfile
8. ✅ 创建 imsvr/Dockerfile
9. ✅ 修复配置文件占位符
10. ✅ 检查源码完整性
11. ✅ 启动 Docker 服务（自动构建镜像）
12. ✅ 等待服务就绪（120秒）
13. ✅ 验证部署结果（4个验证项）

**预计执行时间**: 10-15分钟

---

## 🌐 访问地址

部署完成后，通过以下地址访问：

- **H5前端**: http://服务器IP/h5
- **管理后台**: http://服务器IP/admin

---

## 👤 管理后台登录

- **账号**: 13800138000
- **密码**: 123456

---

## 🔐 数据库连接信息

| 数据库 | 地址 | 账号 | 密码 |
|--------|------|------|------|
| **MySQL 8.0** | localhost:3306 | root | LaBei_MySQL_2025 |
| **Redis 6.2-alpine** | localhost:6379 | - | LaBei_Redis_2025 |
| **MongoDB 5.0** | localhost:27017 | labei_mongo | LaBei_Mongo_2025 |

---

## 📊 服务信息

部署后会启动6个Docker服务：

| 服务 | 容器名 | 端口 |
|------|--------|------|
| MySQL | labei-mysql | 3306 |
| Redis | labei-redis | 6379 |
| MongoDB | labei-mongodb | 27017 |
| API服务 | labei-apiservice | 8080 |
| IM服务 | labei-imsvr | 3000-3003 |
| Nginx | labei-nginx | 80 |

---

## 📝 常用命令

```bash
# 查看服务状态
docker-compose ps

# 查看服务日志
docker-compose logs -f [服务名]

# 重启服务
docker-compose restart

# 停止所有服务
docker-compose down

# 停止并删除数据
docker-compose down -v
```

---

## ⚠️ 系统要求

### 必须安装的软件
- Docker (20.10+)
- Docker Compose (1.29+ 或 V2)
- Git (2.0+)
- Node.js (14+)
- npm (6+)

### 推荐系统
- CentOS 7+ / Ubuntu 20.04+ / Debian 10+
- 最低配置: 2核CPU、4GB内存、20GB磁盘
- 推荐配置: 4核CPU、8GB内存、50GB磁盘

---

## ✅ 验收标准

脚本执行成功后，应满足以下条件：

1. ✅ `docker-compose ps` 显示所有6个服务均为 `up` 状态
2. ✅ 数据库自动创建6张核心表（t_admin、t_user、t_room、t_gift、t_message、t_config）
3. ✅ 可直接访问 http://服务器IP/h5 和 http://服务器IP/admin
4. ✅ 管理后台可使用 13800138000/123456 登录

---

## 🎯 特性

- ✅ **100%零人工干预** - 执行脚本后无需任何手动操作
- ✅ **版本固化** - MySQL 8.0、Redis 6.2-alpine、MongoDB 5.0
- ✅ **密码固化** - 所有密码已预设，不可修改
- ✅ **配置内置** - 所有配置文件内置在脚本中
- ✅ **自动验证** - 4个验证项确保部署成功
- ✅ **完整注释** - 每个步骤都有中文注释

---

## 📦 GitHub 仓库

https://github.com/ffsz1/labei.git

---

**🎉 祝部署顺利！**