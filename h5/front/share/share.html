<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="initial-scale=1, width=device-width, maximum-scale=1, user-scalable=no" />
    <link rel="icon" href="./images/logo.png" type="image/png">
    <title>拉贝星球</title>
    <link rel="stylesheet" href="../lib/toolKit/css/index.css">
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        html,
        body {
            width: 100%;
            height: 100%;
        }

        .content {
            width: 100%;
            height: 100%;
            background: url('images/share_bg.png');
            background-size: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #fff;
            text-align: center;
        }

        .content>div:nth-child(1) img {
            width: 2.43rem;
            height: 2.43rem;
            border-radius: 50%;
            background-color: #fff;
            margin: 3.56rem 0 .3rem 0;
        }

        .title>p:nth-last-child(2) {
            font-size: 0.4rem;
            padding: .3rem 0;
        }

        .title>p:nth-last-child(1) {
            font-size: 0.35rem;
        }

        .tip {
            margin-top: 4rem;
        }

        .tip>p:nth-last-child(2) {
            font-size: 0.5rem;
        }

        .tip>p:nth-last-child(1) {
            font-size: 0.37rem;
            padding: .3rem 0;
        }

        .tip>p>img {
            width: 1.2rem;
            margin-right: .2rem;
            vertical-align: middle;
        }

        .tip>p>span {
            vertical-align: middle;
            font-weight: 600;
        }

        #into {
            width: 6.33rem;
            height: 1.17rem;
            color: #ffffff;
            font-size: 0.4rem;
            margin-top: 0.76rem;
            border: 0;
            line-height: 1.17rem;
            display: block;
            text-decoration: none;
            background: linear-gradient(90deg, rgba(96,166,255,1) 0%, rgba(226,124,255,1) 100%);
            border-radius: 50px;
        }
    </style>
    <script type="text/javascript">
        var FS = {};
        (function (win, FS) {
            var doc = win.document;
            var docEl = doc.documentElement;
            var metaEl = doc.querySelector('meta[name="viewport"]');
            var dpr = 1;
            var scale = 1;
            var fontBase = 16;

            if (window.devicePixelRatio >= 2) {
                scale *= 0.5;
                dpr *= 2;
            }

            docEl.setAttribute('data-dpr', dpr);
            metaEl.setAttribute('content', 'initial-scale=' + scale + ', width=device-width, maximum-scale=' +
                scale +
                ', user-scalable=no');

            function refreshRem() {
                var width = docEl.getBoundingClientRect().width;
                var rem = width / 10;
                docEl.style.fontSize = rem + 'px';
                FS.rem = rem;
            }

            var tid = null;
            win.addEventListener('resize', function () {
                clearTimeout(tid);
                tid = setTimeout(refreshRem, 300);
            }, false);

            if (doc.readyState === 'complete') {
                doc.body.style.fontSize = fontBase * dpr + 'px';
            } else {
                doc.addEventListener('DOMContentLoaded', function (e) {
                    doc.body.style.fontSize = fontBase * dpr + 'px';
                }, false);
            }

            refreshRem();

            FS.dpr = dpr;
            FS.rem2px = function (d) {
                var val = parseFloat(d) * FS.rem;
                if (typeof d === 'string' && d.match(/rem$/)) {
                    val += 'px';
                }
                return val;
            }
            FS.px2rem = function (d) {
                var val = parseFloat(d) / FS.rem;
                if (typeof d === 'string' && d.match(/px$/)) {
                    val += 'rem';
                }
                return val;
            }
        })(window, FS);
    </script>
</head>
<body>
    <div class="content"></div>
    <div style="display:none">
        <script src="https://s13.cnzz.com/z_stat.php?id=1274392224&web_id=1274392224" language="JavaScript"></script>
    </div>
</body>
<script src="../lib/zepto.min.js" type="text/javascript"></script>
<script src="../lib/linkedme.min.js"></script>
<script src="../lib/toolKit/js/index.js"></script>
<script src="../lib/common.js"></script>
<script>
    var config = {
        share: {
            title: '亲，我在拉贝星球等你哦',
            desc: '想要遇见喜欢的声音，就来拉贝星球，让我们不见不散。'
        }
    }
    $('body').hide();
    var share = {
        title: config.share.title, // 分享标题
        link: window.location.href, // 分享链接
        imgUrl: allUrl() + '/home/images/logo.png?v=1.0',
        desc: config.share.desc // 分享描述
    };

    // 分享信息
    function shareInfo() {
        var _url = allUrl() + '/front/download/download.html';
        var info = {
            title: config.share.title, // 分享标题
            showUrl: _url,
            imgUrl: allUrl() + '/home/images/logo.png?v=1.0',
            desc: config.share.desc // 分享描述
        };
        return JSON.stringify(info);
    }
    var _url = location.search;
    var theRequest = new Object();
    if (_url.indexOf('?') != -1) {
        var str = _url.substr(1);
        strs = str.split('&');
        for (var i in strs) {
            theRequest[strs[i].split('=')[0]] = decodeURI(strs[i].split('=')[1]);
        }
    }
    // 获取浏览器UA
    var browser = checkVersion();

    function toastWait() {
        $('.toast').text('敬请期待！').show();
        setTimeout(function () {
            $('.toast').hide();
        }, 1200);
    };

    setTimeout(function () {
        $.ajax({
            url: allUrl() + '/user/get',
            type: 'GET',
            data: {
                uid: theRequest.uid
            },
            asyc: true,
            success: function (res) {
                if (res.code = 200) {
                    linkedme.init("e9cd1de856eec482c92c4800ce16f537", {
                        type: "live"
                    }, null);
                    const data = {};
                    data.type = "live"; //表示现在使用线上模式,如果填写"test", 表示测试模式.【可选】
                    data.params = '{"roomuid":"' + theRequest.shareUid + 
                                  '","uid":"' + theRequest.uid +
                                  '","type":"' + 2 + '"}'
                    linkedme.link(data, function (err, response) {
                        if (err) {

                        } else {
                            $('#linked').html(`<a class="linkedme" id="into" href="${response.url}">\u8FDB\u5165\u623F\u95F4</a>`);
                            // $('#linked').html(`<a class="linkedme" id="into" href="javascript:;" onclick="toastWait()">\u8FDB\u5165\u623F\u95F4</a>`);
                        }
                    }, false);
                    console.log(res.data)
                    $('.content').html(
                        `<div class="title">
                            <img src="${res.data.avatar}" alt="avatar" />
                            <p id="room">${res.data.nick}</p>
                            <p id="uid">ID\uFF1A${res.data.erbanNo}</p>
                        </div>
                        <div class="tip">
                            <p>
                                <img src="./images/logo.png" alt="logo" />
                                <span>拉贝星球</span>
                            </p>
                            <p>一辈子很长，要跟有趣的人一起过</p>
                        </div>
                        <div id="linked"></div>`
                    );
                    $('body').show();
                }
            }
        });
    }, 50);
</script>

</html>