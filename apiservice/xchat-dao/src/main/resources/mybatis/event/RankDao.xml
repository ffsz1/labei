<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.juxiao.xchat.dao.event.RankDao">

    <resultMap id="BaseResultMap" type="com.juxiao.xchat.dao.event.dto.RankDTO">
        <id column="uid" property="uid" jdbcType="BIGINT"/>
        <id column="total_num" property="totalNum" jdbcType="BIGINT"/>
    </resultMap>

    <select id="getAllStarRankList" resultMap="BaseResultMap" parameterType="com.juxiao.xchat.dao.event.query.RankQuery">
        SELECT
        odrr.recv_uid uid,
        SUM(odrr.sum_gold) total_num
        FROM
        one_day_room_recv_sum odrr
        where (odrr.create_time BETWEEN #{startTime,jdbcType=TIMESTAMP} and #{endTime,jdbcType=TIMESTAMP})
        <if test="uid != null">
            and odrr.recv_uid = #{uid,jdbcType=BIGINT}
        </if>
        GROUP BY odrr.recv_uid
        ORDER BY total_num DESC
        LIMIT 0, 100
    </select>

    <select id="getNobelRankList" resultMap="BaseResultMap" parameterType="com.juxiao.xchat.dao.event.query.RankQuery">
        SELECT
        odrss.send_uid uid,
        SUM(odrss.sum_gold) total_num
        FROM
        one_day_room_send_sum odrss
        where (odrss.create_time BETWEEN #{startTime,jdbcType=TIMESTAMP} and #{endTime,jdbcType=TIMESTAMP})
        <if test="uid != null">
            and odrss.send_uid = #{uid,jdbcType=BIGINT}
        </if>
        GROUP BY odrss.send_uid
        ORDER BY total_num DESC
        LIMIT 0, 100
    </select>

    <select id="getAllRoomRankList" resultMap="BaseResultMap" parameterType="com.juxiao.xchat.dao.event.query.RankQuery">
        SELECT
        odrss.uid,
        SUM(odrss.sum_gold) total_num
        FROM
        one_day_room_send_sum odrss
        where (odrss.create_time BETWEEN #{startTime,jdbcType=TIMESTAMP} and #{endTime,jdbcType=TIMESTAMP}) and odrss.uid != 0
        <if test="uid != null">
            and odrss.uid = #{uid,jdbcType=BIGINT}
        </if>
        GROUP BY odrss.uid
        ORDER BY total_num DESC
        LIMIT 0, 100
    </select>

    <select id="getUidStarRank" resultType="com.juxiao.xchat.dao.event.dto.RankDTO">
        SELECT
        odrr.recv_uid uid,
        SUM(odrr.sum_gold) total_num
        FROM
        one_day_room_recv_sum odrr
        where (odrr.create_time BETWEEN #{startTime,jdbcType=TIMESTAMP} and #{endTime,jdbcType=TIMESTAMP})
            and odrr.recv_uid = #{uid,jdbcType=BIGINT}
    </select>

    <select id="getUidNobelRank" resultType="com.juxiao.xchat.dao.event.dto.RankDTO">
        SELECT
        odrss.send_uid uid,
        SUM(odrss.sum_gold) total_num
        FROM
        one_day_room_send_sum odrss
        where (odrss.create_time BETWEEN #{startTime,jdbcType=TIMESTAMP} and #{endTime,jdbcType=TIMESTAMP})
        and odrss.send_uid = #{uid,jdbcType=BIGINT}
    </select>
</mapper>