<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.juxiao.xchat.dao.user.UserGiftWallDao">
    <insert id="save" parameterType="com.juxiao.xchat.dao.user.domain.UserGiftWallDO">
        <selectKey resultType="java.lang.Long" keyProperty="giftWallId" order="AFTER">
            SELECT LAST_INSERT_ID()
        </selectKey>

        <trim prefix="INSERT INTO `user_gift_wall` (" suffix=")" suffixOverrides=",">
            <if test="uid != null">
                uid,
            </if>
            <if test="giftId != null">
                gift_id,
            </if>
            <if test="reciveCount != null">
                recive_count,
            </if>
            <if test="createTime != null">
                create_time,
            </if>
        </trim>
        <trim prefix="VALUES (" suffix=")" suffixOverrides=",">
            <if test="uid != null">
                #{uid,jdbcType=BIGINT},
            </if>
            <if test="giftId != null">
                #{giftId,jdbcType=INTEGER},
            </if>
            <if test="reciveCount != null">
                #{reciveCount,jdbcType=INTEGER},
            </if>
            <if test="createTime != null">
                #{createTime,jdbcType=TIMESTAMP},
            </if>
        </trim>
    </insert>

    <resultMap id="UserWallResultMap" type="com.juxiao.xchat.dao.user.dto.UserGiftWallDTO">
        <id column="gift_wall_id" property="giftWallId" jdbcType="BIGINT"/>
        <result column="uid" property="uid" jdbcType="BIGINT"/>
        <result column="gift_id" property="giftId" jdbcType="INTEGER"/>
        <result column="gift_name" property="giftName" jdbcType="VARCHAR"/>
        <result column="pic_url" property="picUrl" jdbcType="VARCHAR"/>
        <result column="recive_count" property="reciveCount" jdbcType="INTEGER"/>
        <result column="create_time" property="createTime" jdbcType="TIMESTAMP"/>
    </resultMap>

    <select id="listUserGiftOrderTypeWall" parameterType="com.juxiao.xchat.dao.user.query.UserGiftWallOrderTypeQuery" resultMap="UserWallResultMap">
        <![CDATA[
        SELECT
          wall.uid,
          gift.gift_id,
          gift.gift_name,
          gift.pic_url,
          wall.recive_count
        FROM
          `user_gift_wall` wall
        RIGHT JOIN
          `gift` gift
        ON
          wall.`gift_id` = gift.`gift_id`
        WHERE
          wall.uid = #{uid,jdbcType=BIGINT}
        ]]>
<!--        <if test="type != null ">AND gift.gift_type = #{type}</if>-->
        <if test="orderType == 1">ORDER BY wall.recive_count DESC</if>
        <if test="orderType == 2">ORDER BY gift.gold_price DESC</if>
    </select>
</mapper>