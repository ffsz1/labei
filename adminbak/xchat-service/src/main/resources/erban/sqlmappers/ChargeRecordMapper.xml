<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.erban.main.mybatismapper.ChargeRecordMapper">
    <resultMap id="BaseResultMap" type="com.erban.main.model.ChargeRecord">
        <id column="charge_record_id" property="chargeRecordId" jdbcType="VARCHAR"/>
        <result column="uid" property="uid" jdbcType="BIGINT"/>
        <result column="room_uid" property="roomUid" jdbcType="BIGINT"/>
        <result column="pingxx_charge_id" property="pingxxChargeId" jdbcType="VARCHAR"/>
        <result column="charge_prod_id" property="chargeProdId" jdbcType="VARCHAR"/>
        <result column="channel" property="channel" jdbcType="VARCHAR"/>
        <result column="buss_type" property="bussType" jdbcType="TINYINT"/>
        <result column="charge_status" property="chargeStatus" jdbcType="TINYINT"/>
        <result column="charge_status_desc" property="chargeStatusDesc" jdbcType="VARCHAR"/>
        <result column="amount" property="amount" jdbcType="BIGINT"/>
        <result column="total_gold" property="totalGold" jdbcType="BIGINT"/>
        <result column="client_ip" property="clientIp" jdbcType="VARCHAR"/>
        <result column="wx_pub_openid" property="wxPubOpenid" jdbcType="VARCHAR"/>
        <result column="subject" property="subject" jdbcType="VARCHAR"/>
        <result column="body" property="body" jdbcType="VARCHAR"/>
        <result column="extra" property="extra" jdbcType="VARCHAR"/>
        <result column="metadata" property="metadata" jdbcType="VARCHAR"/>
        <result column="charge_desc" property="chargeDesc" jdbcType="VARCHAR"/>
        <result column="create_time" property="createTime" jdbcType="TIMESTAMP"/>
        <result column="update_time" property="updateTime" jdbcType="TIMESTAMP"/>
    </resultMap>
    <sql id="Example_Where_Clause">
        <where>
            <foreach collection="oredCriteria" item="criteria" separator="or">
                <if test="criteria.valid">
                    <trim prefix="(" suffix=")" prefixOverrides="and">
                        <foreach collection="criteria.criteria" item="criterion">
                            <choose>
                                <when test="criterion.noValue">
                                    and ${criterion.condition}
                                </when>
                                <when test="criterion.singleValue">
                                    and ${criterion.condition} #{criterion.value}
                                </when>
                                <when test="criterion.betweenValue">
                                    and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                                </when>
                                <when test="criterion.listValue">
                                    and ${criterion.condition}
                                    <foreach collection="criterion.value" item="listItem" open="(" close=")"
                                             separator=",">
                                        #{listItem}
                                    </foreach>
                                </when>
                            </choose>
                        </foreach>
                    </trim>
                </if>
            </foreach>
        </where>
    </sql>
    <sql id="Update_By_Example_Where_Clause">
        <where>
            <foreach collection="example.oredCriteria" item="criteria" separator="or">
                <if test="criteria.valid">
                    <trim prefix="(" suffix=")" prefixOverrides="and">
                        <foreach collection="criteria.criteria" item="criterion">
                            <choose>
                                <when test="criterion.noValue">
                                    and ${criterion.condition}
                                </when>
                                <when test="criterion.singleValue">
                                    and ${criterion.condition} #{criterion.value}
                                </when>
                                <when test="criterion.betweenValue">
                                    and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                                </when>
                                <when test="criterion.listValue">
                                    and ${criterion.condition}
                                    <foreach collection="criterion.value" item="listItem" open="(" close=")"
                                             separator=",">
                                        #{listItem}
                                    </foreach>
                                </when>
                            </choose>
                        </foreach>
                    </trim>
                </if>
            </foreach>
        </where>
    </sql>
    <sql id="Base_Column_List">
        charge_record_id, uid, room_uid, pingxx_charge_id, charge_prod_id, channel, buss_type,
        charge_status, charge_status_desc, amount, total_gold, client_ip, wx_pub_openid,
        subject, body, extra, metadata, charge_desc, create_time, update_time
    </sql>
    <select id="selectByExample" resultMap="BaseResultMap" parameterType="com.erban.main.model.ChargeRecordExample">
        select
        <if test="distinct">
            distinct
        </if>
        'true' as QUERYID,
        <include refid="Base_Column_List"/>
        from charge_record
        <if test="_parameter != null">
            <include refid="Example_Where_Clause"/>
        </if>
        <if test="orderByClause != null">
            order by ${orderByClause}
        </if>
    </select>
    <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.String">
        select
        <include refid="Base_Column_List"/>
        from charge_record
        where charge_record_id = #{chargeRecordId,jdbcType=VARCHAR}
    </select>
    <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
        delete from charge_record where charge_record_id = #{chargeRecordId,jdbcType=VARCHAR}
    </delete>
    <delete id="deleteByExample" parameterType="com.erban.main.model.ChargeRecordExample">
        delete from charge_record
        <if test="_parameter != null">
            <include refid="Example_Where_Clause"/>
        </if>
    </delete>
    <insert id="insert" parameterType="com.erban.main.model.ChargeRecord">
        insert into charge_record (charge_record_id, uid, room_uid,
                    pingxx_charge_id, charge_prod_id, channel,
                    buss_type, charge_status, charge_status_desc,
                    amount, total_gold, client_ip,
                    wx_pub_openid, subject, body,
                    extra, metadata, charge_desc,
                    create_time, update_time)
        values (#{chargeRecordId,jdbcType=VARCHAR}, #{uid,jdbcType=BIGINT}, #{roomUid,jdbcType=BIGINT},
                #{pingxxChargeId,jdbcType=VARCHAR}, #{chargeProdId,jdbcType=VARCHAR}, #{channel,jdbcType=VARCHAR},
                #{bussType,jdbcType=TINYINT}, #{chargeStatus,jdbcType=TINYINT}, #{chargeStatusDesc,jdbcType=VARCHAR},
                #{amount,jdbcType=BIGINT}, #{totalGold,jdbcType=BIGINT}, #{clientIp,jdbcType=VARCHAR},
                #{wxPubOpenid,jdbcType=VARCHAR}, #{subject,jdbcType=VARCHAR}, #{body,jdbcType=VARCHAR},
                #{extra,jdbcType=VARCHAR}, #{metadata,jdbcType=VARCHAR}, #{chargeDesc,jdbcType=VARCHAR},
                #{createTime,jdbcType=TIMESTAMP}, #{updateTime,jdbcType=TIMESTAMP})
    </insert>
    <insert id="insertSelective" parameterType="com.erban.main.model.ChargeRecord">
        insert into charge_record
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="chargeRecordId != null">
                charge_record_id,
            </if>
            <if test="uid != null">
                uid,
            </if>
            <if test="roomUid != null">
                room_uid,
            </if>
            <if test="pingxxChargeId != null">
                pingxx_charge_id,
            </if>
            <if test="chargeProdId != null">
                charge_prod_id,
            </if>
            <if test="channel != null">
                channel,
            </if>
            <if test="bussType != null">
                buss_type,
            </if>
            <if test="chargeStatus != null">
                charge_status,
            </if>
            <if test="chargeStatusDesc != null">
                charge_status_desc,
            </if>
            <if test="amount != null">
                amount,
            </if>
            <if test="totalGold != null">
                total_gold,
            </if>
            <if test="clientIp != null">
                client_ip,
            </if>
            <if test="wxPubOpenid != null">
                wx_pub_openid,
            </if>
            <if test="subject != null">
                subject,
            </if>
            <if test="body != null">
                body,
            </if>
            <if test="extra != null">
                extra,
            </if>
            <if test="metadata != null">
                metadata,
            </if>
            <if test="chargeDesc != null">
                charge_desc,
            </if>
            <if test="createTime != null">
                create_time,
            </if>
            <if test="updateTime != null">
                update_time,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="chargeRecordId != null">
                #{chargeRecordId,jdbcType=VARCHAR},
            </if>
            <if test="uid != null">
                #{uid,jdbcType=BIGINT},
            </if>
            <if test="roomUid != null">
                #{roomUid,jdbcType=BIGINT},
            </if>
            <if test="pingxxChargeId != null">
                #{pingxxChargeId,jdbcType=VARCHAR},
            </if>
            <if test="chargeProdId != null">
                #{chargeProdId,jdbcType=VARCHAR},
            </if>
            <if test="channel != null">
                #{channel,jdbcType=VARCHAR},
            </if>
            <if test="bussType != null">
                #{bussType,jdbcType=TINYINT},
            </if>
            <if test="chargeStatus != null">
                #{chargeStatus,jdbcType=TINYINT},
            </if>
            <if test="chargeStatusDesc != null">
                #{chargeStatusDesc,jdbcType=VARCHAR},
            </if>
            <if test="amount != null">
                #{amount,jdbcType=BIGINT},
            </if>
            <if test="totalGold != null">
                #{totalGold,jdbcType=BIGINT},
            </if>
            <if test="clientIp != null">
                #{clientIp,jdbcType=VARCHAR},
            </if>
            <if test="wxPubOpenid != null">
                #{wxPubOpenid,jdbcType=VARCHAR},
            </if>
            <if test="subject != null">
                #{subject,jdbcType=VARCHAR},
            </if>
            <if test="body != null">
                #{body,jdbcType=VARCHAR},
            </if>
            <if test="extra != null">
                #{extra,jdbcType=VARCHAR},
            </if>
            <if test="metadata != null">
                #{metadata,jdbcType=VARCHAR},
            </if>
            <if test="chargeDesc != null">
                #{chargeDesc,jdbcType=VARCHAR},
            </if>
            <if test="createTime != null">
                #{createTime,jdbcType=TIMESTAMP},
            </if>
            <if test="updateTime != null">
                #{updateTime,jdbcType=TIMESTAMP},
            </if>
        </trim>
    </insert>
    <select id="countByExample" parameterType="com.erban.main.model.ChargeRecordExample" resultType="java.lang.Integer">
        select count(*) from charge_record
        <if test="_parameter != null">
            <include refid="Example_Where_Clause"/>
        </if>
    </select>
    <update id="updateByExampleSelective" parameterType="map">
        update charge_record
        <set>
            <if test="record.chargeRecordId != null">
                charge_record_id = #{record.chargeRecordId,jdbcType=VARCHAR},
            </if>
            <if test="record.uid != null">
                uid = #{record.uid,jdbcType=BIGINT},
            </if>
            <if test="record.roomUid != null">
                room_uid = #{record.roomUid,jdbcType=BIGINT},
            </if>
            <if test="record.pingxxChargeId != null">
                pingxx_charge_id = #{record.pingxxChargeId,jdbcType=VARCHAR},
            </if>
            <if test="record.chargeProdId != null">
                charge_prod_id = #{record.chargeProdId,jdbcType=VARCHAR},
            </if>
            <if test="record.channel != null">
                channel = #{record.channel,jdbcType=VARCHAR},
            </if>
            <if test="record.bussType != null">
                buss_type = #{record.bussType,jdbcType=TINYINT},
            </if>
            <if test="record.chargeStatus != null">
                charge_status = #{record.chargeStatus,jdbcType=TINYINT},
            </if>
            <if test="record.chargeStatusDesc != null">
                charge_status_desc = #{record.chargeStatusDesc,jdbcType=VARCHAR},
            </if>
            <if test="record.amount != null">
                amount = #{record.amount,jdbcType=BIGINT},
            </if>
            <if test="record.totalGold != null">
                total_gold = #{record.totalGold,jdbcType=BIGINT},
            </if>
            <if test="record.clientIp != null">
                client_ip = #{record.clientIp,jdbcType=VARCHAR},
            </if>
            <if test="record.wxPubOpenid != null">
                wx_pub_openid = #{record.wxPubOpenid,jdbcType=VARCHAR},
            </if>
            <if test="record.subject != null">
                subject = #{record.subject,jdbcType=VARCHAR},
            </if>
            <if test="record.body != null">
                body = #{record.body,jdbcType=VARCHAR},
            </if>
            <if test="record.extra != null">
                extra = #{record.extra,jdbcType=VARCHAR},
            </if>
            <if test="record.metadata != null">
                metadata = #{record.metadata,jdbcType=VARCHAR},
            </if>
            <if test="record.chargeDesc != null">
                charge_desc = #{record.chargeDesc,jdbcType=VARCHAR},
            </if>
            <if test="record.createTime != null">
                create_time = #{record.createTime,jdbcType=TIMESTAMP},
            </if>
            <if test="record.updateTime != null">
                update_time = #{record.updateTime,jdbcType=TIMESTAMP},
            </if>
        </set>
        <if test="_parameter != null">
            <include refid="Update_By_Example_Where_Clause"/>
        </if>
    </update>
    <update id="updateByExample" parameterType="map">
        update charge_record
        set charge_record_id = #{record.chargeRecordId,jdbcType=VARCHAR},
            uid = #{record.uid,jdbcType=BIGINT},
            room_uid = #{record.roomUid,jdbcType=BIGINT},
            pingxx_charge_id = #{record.pingxxChargeId,jdbcType=VARCHAR},
            charge_prod_id = #{record.chargeProdId,jdbcType=VARCHAR},
            channel = #{record.channel,jdbcType=VARCHAR},
            buss_type = #{record.bussType,jdbcType=TINYINT},
            charge_status = #{record.chargeStatus,jdbcType=TINYINT},
            charge_status_desc = #{record.chargeStatusDesc,jdbcType=VARCHAR},
            amount = #{record.amount,jdbcType=BIGINT},
            total_gold = #{record.totalGold,jdbcType=BIGINT},
            client_ip = #{record.clientIp,jdbcType=VARCHAR},
            wx_pub_openid = #{record.wxPubOpenid,jdbcType=VARCHAR},
            subject = #{record.subject,jdbcType=VARCHAR},
            body = #{record.body,jdbcType=VARCHAR},
            extra = #{record.extra,jdbcType=VARCHAR},
            metadata = #{record.metadata,jdbcType=VARCHAR},
            charge_desc = #{record.chargeDesc,jdbcType=VARCHAR},
            create_time = #{record.createTime,jdbcType=TIMESTAMP},
            update_time = #{record.updateTime,jdbcType=TIMESTAMP}
        <if test="_parameter != null">
            <include refid="Update_By_Example_Where_Clause"/>
        </if>
    </update>
    <update id="updateByPrimaryKeySelective" parameterType="com.erban.main.model.ChargeRecord">
        update charge_record
        <set>
            <if test="uid != null">
                uid = #{uid,jdbcType=BIGINT},
            </if>
            <if test="roomUid != null">
                room_uid = #{roomUid,jdbcType=BIGINT},
            </if>
            <if test="pingxxChargeId != null">
                pingxx_charge_id = #{pingxxChargeId,jdbcType=VARCHAR},
            </if>
            <if test="chargeProdId != null">
                charge_prod_id = #{chargeProdId,jdbcType=VARCHAR},
            </if>
            <if test="channel != null">
                channel = #{channel,jdbcType=VARCHAR},
            </if>
            <if test="bussType != null">
                buss_type = #{bussType,jdbcType=TINYINT},
            </if>
            <if test="chargeStatus != null">
                charge_status = #{chargeStatus,jdbcType=TINYINT},
            </if>
            <if test="chargeStatusDesc != null">
                charge_status_desc = #{chargeStatusDesc,jdbcType=VARCHAR},
            </if>
            <if test="amount != null">
                amount = #{amount,jdbcType=BIGINT},
            </if>
            <if test="totalGold != null">
                total_gold = #{totalGold,jdbcType=BIGINT},
            </if>
            <if test="clientIp != null">
                client_ip = #{clientIp,jdbcType=VARCHAR},
            </if>
            <if test="wxPubOpenid != null">
                wx_pub_openid = #{wxPubOpenid,jdbcType=VARCHAR},
            </if>
            <if test="subject != null">
                subject = #{subject,jdbcType=VARCHAR},
            </if>
            <if test="body != null">
                body = #{body,jdbcType=VARCHAR},
            </if>
            <if test="extra != null">
                extra = #{extra,jdbcType=VARCHAR},
            </if>
            <if test="metadata != null">
                metadata = #{metadata,jdbcType=VARCHAR},
            </if>
            <if test="chargeDesc != null">
                charge_desc = #{chargeDesc,jdbcType=VARCHAR},
            </if>
            <if test="createTime != null">
                create_time = #{createTime,jdbcType=TIMESTAMP},
            </if>
            <if test="updateTime != null">
                update_time = #{updateTime,jdbcType=TIMESTAMP},
            </if>
        </set>
        where charge_record_id = #{chargeRecordId,jdbcType=VARCHAR}
    </update>
    <update id="updateByPrimaryKey" parameterType="com.erban.main.model.ChargeRecord">
        update charge_record
        set uid = #{uid,jdbcType=BIGINT},
            room_uid = #{roomUid,jdbcType=BIGINT},
            pingxx_charge_id = #{pingxxChargeId,jdbcType=VARCHAR},
            charge_prod_id = #{chargeProdId,jdbcType=VARCHAR},
            channel = #{channel,jdbcType=VARCHAR},
            buss_type = #{bussType,jdbcType=TINYINT},
            charge_status = #{chargeStatus,jdbcType=TINYINT},
            charge_status_desc = #{chargeStatusDesc,jdbcType=VARCHAR},
            amount = #{amount,jdbcType=BIGINT},
            total_gold = #{totalGold,jdbcType=BIGINT},
            client_ip = #{clientIp,jdbcType=VARCHAR},
            wx_pub_openid = #{wxPubOpenid,jdbcType=VARCHAR},
            subject = #{subject,jdbcType=VARCHAR},
            body = #{body,jdbcType=VARCHAR},
            extra = #{extra,jdbcType=VARCHAR},
            metadata = #{metadata,jdbcType=VARCHAR},
            charge_desc = #{chargeDesc,jdbcType=VARCHAR},
            create_time = #{createTime,jdbcType=TIMESTAMP},
            update_time = #{updateTime,jdbcType=TIMESTAMP}
        where charge_record_id = #{chargeRecordId,jdbcType=VARCHAR}
    </update>

    <resultMap id="QueryResultMap" type="com.erban.main.vo.admin.ChargeRecordVo">
        <id column="charge_record_id" property="chargeRecordId" jdbcType="VARCHAR"/>
        <result column="pingxx_charge_id" property="pingxxChargeId" jdbcType="VARCHAR"/>
        <result column="channel" property="channel" jdbcType="VARCHAR"/>
        <result column="buss_type" property="bussType" jdbcType="TINYINT"/>
        <result column="charge_status" property="chargeStatus" jdbcType="TINYINT"/>
        <result column="amount" property="amount" jdbcType="BIGINT"/>
        <result column="total_gold" property="totalGold" jdbcType="BIGINT"/>
        <result column="client_ip" property="clientIp" jdbcType="VARCHAR"/>
        <result column="subject" property="subject" jdbcType="VARCHAR"/>
        <result column="charge_desc" property="chargeDesc" jdbcType="VARCHAR"/>
        <result column="create_time" property="createTime" jdbcType="TIMESTAMP"/>
        <result column="update_time" property="updateTime" jdbcType="TIMESTAMP"/>
        <result column="os" property="os" jdbcType="VARCHAR"/>
        <result column="uid" property="uid" jdbcType="BIGINT"/>
        <result column="erban_no" property="erbanNo" jdbcType="BIGINT"/>
        <result column="phone" property="phone" jdbcType="VARCHAR"/>
        <result column="nick" property="nick" jdbcType="VARCHAR"/>
        <result column="gender" property="gender"/>
    </resultMap>
    <sql id="Query_Column_List">
        c.charge_record_id as charge_record_id, c.pingxx_charge_id as pingxx_charge_id, c.channel as channel,c.buss_type as buss_type,
        c.charge_status as charge_status, c.amount as amount, c.total_gold as total_gold, c.client_ip as client_ip,
        c.subject as subject,c.charge_desc as charge_desc, c.create_time as create_time, c.update_time as update_time,
        u.uid as uid,u.erban_no as erban_no,u.phone as phone ,u.nick as nick,u.os as os,u.gender as gender
    </sql>
    <sql id="Query_where">
        u.def_user != '3'
        <if test="erbanNo != null">
            AND u.erban_no = #{erbanNo}
        </if>
        <if test="os != null and os != ''">
            AND u.os = #{os}
        </if>
        <if test="gender != null">
            AND u.gender = #{gender}
        </if>
        <if test="chargeProdId != null">
            AND c.charge_prod_id = #{chargeProdId}
        </if>
        <if test="minValue != null and minValue != ''">
            AND c.total_gold <![CDATA[ >= ]]> #{minValue}
        </if>
        <if test="maxValue != null and maxValue != ''">
            AND c.total_gold <![CDATA[ <= ]]> #{maxValue}
        </if>
        <if test="beginDate != null">
            AND c.create_time <![CDATA[ >= ]]> #{beginDate}
        </if>
        <if test="endDate != null">
            AND c.create_time <![CDATA[ <= ]]> #{endDate}
        </if>
        <if test="status != null">
            AND c.charge_status = #{status}
        </if>
        <if test="channel != null and channel != ''">
            AND c.channel = #{channel}
        </if>
        <choose>
            <when test="type==1">
                and not c.charge_prod_id in ('exchange', 'company')
            </when>
            <when test="type==2">
                and c.charge_prod_id = 'exchange'
            </when>
            <when test="type==3">
                and c.charge_prod_id = 'company'
            </when>
        </choose>
    </sql>
    <select id="selectByQuery" resultMap="QueryResultMap" parameterType="com.erban.main.param.admin.ChargeRecordParam">
        select
        <include refid="Query_Column_List"/>
        from charge_record c
        LEFT JOIN users u ON c.uid = u.uid
        <where>
            <include refid="Query_where"></include>
        </where>
        ORDER BY c.create_time DESC
    </select>
    <select id="queryUserCount" resultType="com.erban.main.vo.admin.ChargeRecordVo"
            parameterType="com.erban.main.param.admin.ChargeRecordParam">
        select u.gender as gender, COUNT(DISTINCT c.uid) as num
        from charge_record c
        LEFT JOIN users u ON c.uid = u.uid
        <where>
            <include refid="Query_where"></include>
        </where>
        group BY u.gender
    </select>
    <select id="queryTotalAmount" resultType="java.math.BigDecimal"
            parameterType="com.erban.main.param.admin.ChargeRecordParam">
        select sum(c.amount)
        from charge_record c
        LEFT JOIN users u ON c.uid = u.uid
        <where>
            <include refid="Query_where"></include>
        </where>
    </select>
    <select id="sumAmount" resultType="com.erban.main.model.ChargeRecord" parameterType="java.util.List">
        SELECT uid, sum(amount) as amount
        FROM charge_record
        WHERE charge_status = '2' AND pingxx_charge_id IS NOT NULL AND uid IN
        <foreach collection="list" index="index" item="item" open="(" separator="," close=")">
            #{item}
        </foreach>
        GROUP BY uid
    </select>
</mapper>
