<style>
    .bar1, .bar2 {
        margin-bottom: 10px;
    }

    label.col-sm-1 {
        padding: 0;
        line-height: 30px;
        text-align: right;
        /*padding-right: 4px;*/
    }

    label.col-sm-1 {
        padding: 0;
        line-height: 30px;
        text-align: right;
        /*padding-right: 4px;*/
    }

    input, select {
        margin-left: 8px;
        margin-right: 8px;
    }

    .record {
        margin-top: 10px;
    }

    .record .title {
        font-size: 16px;
    }

    .content .form-group {
        margin-right: 2rem;
    }

    .content .form-group label {
        margin-right: 1rem;
    }
</style>
<section class="content">
    <div class="box box-primary">
        <div class="box-body">
            <section class="content-header">
                <h1 id="itemTitle"></h1>
            </section>
            <section class="content">
                <div id="table"></div>
                <div id="toolbar">
                    <form class="form-inline">
                        <div class="form-group">
                            <label for="erbanNo" class="control-label">当前拉贝号:</label>
                            <input type="text" name="erbanNo" id="erbanNo" class="form-control validate[required]">
                        </div>
                        <div class="form-group">
                            <label for="approveErbanNo" class="col-sm-3 control-label">申请审核靓号:</label>
                            <input type="text" name="approveErbanNo" id="approveErbanNo"
                                   class="form-control validate[required]">
                        </div>
                        <!-- <div class="form-group">
                             <label for="nobleId" class="col-sm-3 control-label">贵族ID:</label>
                             <div class="col-sm-3">
                                 <div><input type="text" name="nobleId" id="nobleId" class="form-control validate[required]"></div>
                             </div>

                             <label for="nobleName" class="col-sm-3 control-label">贵族名称:</label>
                             <div class="col-sm-3">
                                 <div><input type="text" name="nobleName" id="nobleName" class="form-control validate[required]"></div>
                             </div>
                         </div>-->
                        <div class="form-group">
                            <label for="approveResult" class="control-label">审核结果：</label>
                            <select name="approveResult" id="approveResult" class="form-control">
                                <option value="1">待审核</option>
                                <option value="2">审核通过</option>
                                <option value="3">审核不通过</option>
                            </select>
                        </div>
                        <a href="javascript:;" id="btnSearch" class="btn btn-primary"><i
                                class="glyphicon glyphicon-search"></i> 查询</a>
                    </form>
                    <!--<button id="add" class="btn btn-default">
                        <i class="glyphicon glyphicon-plus"></i>新增审核
                    </button>-->
                </div>
            </section>
        </div>
    </div>
</section>

<!--删除-->
<div class="modal fade" id="delcfmModel">
    <div class="modal-dialog">
        <div class="modal-content message_align">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">×</span></button>
                <h4 class="modal-title">提示信息</h4>
            </div>
            <div class="modal-body">
                <p>您确认要删除吗？</p>
            </div>
            <div class="modal-footer">
                <input type="hidden" id="url"/>
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" id="doDelete">确认</button>
            </div>
        </div>
    </div>
</div>


<!--增加对话框
<div class="modal fade" id="addPrettyNoApproveModel" tabindex="-1" role="dialog" aria-labelledby="modalLabel2">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">x</span></button>
                <h4 class="modal-title" id="addModalLabel">新增审核</h4>
            </div>
            <div class="modal-body">
                <form id="addPrettyAppNoForm" class="form-horizontal">
                    <div class="form-group">
                        <label for="prettyErbanNo" class="col-sm-3 control-label">请输入靓号：</label>
                        <div class="col-sm-3">
                            <input type="text" class="form-control validate[required]" name="prettyErbanNo" id="prettyErbanNo"/>
                        </div>
                    </div>

                    <div class="form-group"  id ="mmm">
                        <label for="useId" class="col-sm-3 control-label">请输入使用人ID:</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control validate[required]" name="useId" id="useId"/>
                        </div>
                    </div>

                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" id="addSave">审核</button>
            </div>
        </div>
    </div>
</div>-->


<script>
    $(function () {
        $('#table').bootstrapTable('destroy');
        $('#table').bootstrapTable({
            columns: [
                {field: 'recordId', title: '记录ID', align: 'center', valign: 'middle', width: '0%', visible: false},
                {field: 'erbanNo', title: '当前拉贝号', align: 'center', valign: 'middle', width: 150},
                {field: 'nobleId', title: '贵族ID', align: 'center', valign: 'middle', width: 150},
                {field: 'nobleName', title: '贵族名称', align: 'center', valign: 'middle', width: 200},
                {
                    field: 'createTime',
                    title: '创建时间',
                    align: 'center',
                    width: 200,
                    valign: 'middle',
                    formatter: function (val, row, index) {
                        if (val) {
                            const date = new Date(val);
                            return date.format("yyyy-MM-dd HH:mm:ss");
                        } else {
                            return '-';
                        }
                    }
                },
                {field: 'approveErbanNo', title: '申请审核靓号', align: 'center', valign: 'middle', width: 200},
                {
                    field: 'approveResult',
                    title: '申请结果',
                    align: 'center',
                    width: 150,
                    valign: 'middle',
                    formatter: function (val, row, index) {
                        switch (val) {
                            case 1:
                                return '审核中';
                            case 2:
                                return '审核通过';
                            case 3:
                                return '审核不通过';
                        }
                    }
                },
                {field: 'approveDesc', title: '审核结果说明', align: 'center', valign: 'middle', width: 250},
                {
                    field: 'approveTime',
                    title: '审核时间',
                    align: 'center',
                    width: 200,
                    valign: 'middle',
                    formatter: function (val, row, index) {
                        if (val) {
                            const date = new Date(val);
                            return date.format("yyyy-MM-dd HH:mm:ss");
                        } else {
                            return '-';
                        }
                    }
                },
                {field: 'adminId', title: '审核管理员', align: 'center', valign: 'middle', width: 150},
                {
                    field: 'tmp',
                    title: '操作',
                    align: 'center',
                    width: 250,
                    valign: 'middle',
                    formatter: function (val, row, index) {
                        const key = row.recordId;
                        return "<button class='btn btn-success opt-check'  data-id=" + key + " ><i class='glyphicon glyphicon-ok-sign'></i> 审核</button>" +
                            "<button class='btn btn-danger opt-del'  data-id=" + key + " ><i class='glyphicon glyphicon-remove-sign'></i> 删除</button>";
                    }
                }
            ],
            cache: false,
            striped: true,
            showRefresh: false,
            pageSize: 10,
            pagination: true,
            pageList: [10, 20, 30, 50],
            sidePagination: "server", //表示服务端请求
            queryParamsType: "undefined",
            queryParams: function queryParams(params) {   //设置查询参数
                var param = {
                    pageSize: params.pageSize,
                    pageNum: params.pageNumber,
                    prettyErbanNo: $("#approveErbanNo").val(),
                    userErbanNo: $("#erbanNo").val(),
                    approveResult: $("#approveResult").val(),
                };
                return param;
            },
            uniqueId: 'code',
            toolbar: '#toolbar',
            url: '/admin/PrettyNoApplicationList.action',
            onLoadSuccess: function () {  //加载成功时执行
                console.log("load success");
            },
            onLoadError: function () {  //加载失败时执行
                console.log("load fail");
            }
        })
    })

    /*查询刷新*/
    $('#btnSearch').on('click', function () {
        TableHelper.doRefresh('#table');
    })
    /*//增加
    $('#add').on('click', function () {
        $('#addPrettyAppNoForm')[0].reset();
        $('#addPrettyNoApproveModel').modal('show');
    })*/

    /*删除*/
    $("#doDelete").click(function () {
        $.ajax({
            type: 'post',
            url: '/admin/deleteUserNobleApp.action',
            data: {'rowId': $(this).data('id')},
            dataType: 'json',
            success: function (data) {
                if (data == 1) {
                    $("#tipMsg").text("删除成功");
                    $("#tipModal").modal('show');
                    $('#delcfmModel').modal('hide');
                    TableHelper.doRefresh("#table");
                } else {
                    $("#tipMsg").text("删除失败，错误码：" + data);
                    $("#tipModal").modal('show');
                }
            }
        })
    })


    $('#table').on('click', '.opt-del', function () {
        var key = parseInt($(this).data('id'));
        $("#doDelete").data('id', key);
        $("#rowId").val(key);
        console.log(key, typeof key);
        $('#delcfmModel').modal();
    })


    /**
     * 审核
     */
    $('#table').on('click', '.opt-check', function () {
        var key = parseInt($(this).data('id'));
        $("#rowId").val(key);
        console.log(key, typeof key);
        $.ajax({
            type: "post",
            url: "/admin/savePrettyNoApplication.action",
            data: {
                rowId: key,
                prettyErbanNo: $("#prettyErbanNo").val(),
                userErbanNo: $("#useId").val()
            },
            dataType: 'json',
            success: function (data) {
                if (data == 1) {
                    $("#tipMsg").text("恭喜，审核通过");
                    $("#tipModal").modal('show');
                    TableHelper.doRefresh("#table");
                } else if (data == 2) {
                    $("#tipMsg").text("审核不通过,该靓号已经被使用");
                    $("#tipModal").modal('show');
                } else if (data == 3) {
                    $("#tipMsg").text("该拉贝号已有靓号，不可重复申请");
                    $("#tipModal").modal('show');
                } else if (data == 4) {
                    $("#tipMsg").text("贵族身份失效");
                    $("#tipModal").modal('show');
                } else if (data == 5) {
                    $("#tipMsg").text("已审核成功，无需再审核");
                    $("#tipModal").modal('show');
                } else if (data == 5) {
                    $("#tipMsg").text("审核不通过，请重新提交");
                    $("#tipModal").modal('show');
                } else {
                    /* $('#addPrettyNoApproveModel').modal('hide');*/
                    $("#tipMsg").text("审核不通过，错误码：" + data);
                    $("#tipModal").modal('show');
                }
            }
        })
    })


</script>

